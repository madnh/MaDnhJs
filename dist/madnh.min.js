!function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(c){return a.M=b(c)}):a.M=b(a._)}(this,function(a){function b(b,c,d){return d||a.isUndefined(d)?b+"_"+c:c}function c(a,b){return a!==b}function d(a,b){return a!=b}function e(b,e,f){if(arguments.length<2)return{};var g={};return a.isFunction(b)||(b=b?c:d),f=j.mergeObject.apply(j,k.call(arguments,2)),a.each(e,function(a,c){f.hasOwnProperty(c)?b(a,f[c])&&(g[c]=a):g[c]=a}),g}function f(a,b){return function(){console[a].apply(console,(b?[b]:[]).concat(k.apply(arguments)))}}function g(a,b){return a-b}function h(a,b){return b-a}var i="1.2.8",j={};Object.defineProperty(j,"VERSION",{value:i});var k=Array.prototype.slice;j.sliceArguments=function(a,b,c){return k.apply(a,k.call(arguments,1))},j.beNumber=function(b,c){return b=parseFloat(b),j.isNumeric(b)?b:a.isUndefined(c)?0:j.isNumeric(c)?parseFloat(c):j.beNumber(c,0)},j.beObject=function(b,c){switch(!0){case 1==arguments.length:return a.isObject(b)?b:a.isArray(b)||a.isArguments(b)?a.zipObject(Object.keys(b),b):{0:b};case arguments.length>=2:if(a.isObject(b))return b;var d={};return d[b]=c,d}return{}};var l={};l.string=function(a){return a+""},l["boolean"]=function(a){return Boolean(a)},l.number=function(a){return j.beNumber(a)},l.integer=function(a){return Math.floor(j.beNumber(a))},l.array=a.castArray,l.object=function(a){return j.beObject(a)},j.castItemsType=function(b,c){if(!l.hasOwnProperty(c))throw new Error("Invalid cast type. Available types are: string, number, integer, array and object");return a.isArray(b)?a.map(a.clone(b),l[c]):a.mapObject(a.clone(b),l[c])},j.loop=function(b,c,d){var e,f;if(a.isUndefined(d)&&(d="break"),a.isArray(b))for(e=0,f=b.length;f>e&&c(b[e],e,b)!==d;e++);else{var g=a.keys(b);for(e=0,f=g.length;f>e&&c(b[g[e]],g[e],b)!==d;e++);}return b};var m={};j.nextID=function(c,d){return a.isEmpty(c)&&(c="unique_id"),m.hasOwnProperty(c)?m[c]++:m[c]=1,b(c,m[c],d)},j.currentID=function(c,d){return a.isEmpty(c)&&(c="unique_id"),m.hasOwnProperty(c)?b(c,m[c],d):!1},j.resetID=function(b,c){return arguments.length||(b="unique_id"),b=String(b),a.isUndefined(c)?delete m[b]:(c=arguments.length>1?j.beNumber(c):0,c=Math.max(c,0),m[b]=c),c},j.className=function(a,b){return b?a.constructor.name:Object.prototype.toString.call(a)},j.contentType=function(a){var b=typeof a;if("object"===b){var c=j.className(a,!0);if(c)return c}return b},j.isInstanceOf=function(a,b){return j.className(a,!0)===b},j.isPrimitiveType=function(b){if(a.isObject(b))return!1;var c=typeof b;return null==b||"string"===c||"number"===c||"boolean"===c},j.mergeObject=function(){for(var b=0,c=0,d=arguments.length;d>c;c++)!a.isArray(arguments[c])&&a.isObject(arguments[c])||(arguments[c]=a.castArray(arguments[c]),arguments[c]=a.zipObject(a.range(b,b+=arguments[c].length),arguments[c]));return a.extend.apply(a,arguments)},j.diffObject=function(b,d){var f=a.flatten(a.toArray(arguments));return f.unshift(c),e.apply(null,f)},j.diffObjectLoose=function(b,c){var f=a.flatten(a.toArray(arguments));return f.unshift(d),e.apply(null,f)},j.diffObjectWith=function(a,b,c){return e.apply(null,k.apply(arguments))},j.randomString=function(b,c){var d,e,f="";for(!a.isUndefined(c)&&c.toString().length||(c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),d=c.length,b=j.beNumber(b,10),e=b;e>0;--e)f+=c[Math.round(Math.random()*(d-1))];return f},j.setup=function(b,c,d){return a.isObject(b)||(b={}),a.isObject(c)?a.each(c,function(c,d){a.set(b,d,c)}):a.set(b,c,d),b},j.validKeys=function(b,c){var d=[];c=a.castArray(c);for(var e=0,f=c.length;f>e;e++)b.hasOwnProperty(c[e])&&d.push(c[e]);return d},j.pairsAsObject=function(b,c,d){var e=[],f=c||"key",g=d||"value";return a.each(b,function(a,b){var c={};c[f]=b,c[g]=a,e.push(c)}),e},j.pluckBy=function(b,c,d){var e={};return a.each(b,function(a){a.hasOwnProperty(c)&&(e[a[c]]=a.hasOwnProperty(d)?a[d]:void 0)}),e},j.isNumeric=function(b){return!a.isArray(b)&&b-parseFloat(b)+1>=0},j.oneOf=function(b,c,d){return-1!==c.indexOf(b)?b:arguments.length>=3?d:a.first(c)},j.escapeURL=function(a,b){return b?encodeURIComponent(a):encodeURI(a)},j.unescapeURL=function(a,b){return b?decodeURI(a):decodeURIComponent(a)},j.chunks=function(b,c){return a.chunk(b,Math.ceil(b.length/c))},j.toggle=function(b,c,d){if(c=a.uniq(a.castArray(c)),a.isUndefined(d)){var e=a.intersection(b,c),f=a.difference(c,b);b=a.union(a.difference(b,e),f)}else b=d?a.union(b,c):a.difference(b,c);return b},j.defineObject=function(b){var c={};return a.each(b,function(b,d){d=d.trim(),a.has(c,d)||Object.defineProperty(c,d,{enumerable:!a.isFunction(b),value:b})}),c},j.defineConstant=function(b,c,d){var e={};a.isObject(c)?(e=c,d=void 0):e[c]=d,a.each(e,function(a,c){c=c.trim().toUpperCase(),b.hasOwnProperty(c)||Object.defineProperty(b,c,{enumerable:!0,value:a})})},j.inherit=function(b,c,d){var e=b.prototype=Object.create(c.prototype);e.constructor=b,(d||a.isUndefined(d))&&(e._super=c.prototype)},j.callFunc=function(b,c,d){if(c=arguments.length>=2?a.castArray(c):[],b){if(a.isFunction(b))return b.apply(d||null,c);if(a.isString(b)){if(window.hasOwnProperty(b)&&a.isFunction(window[b]))return window[b].apply(d||null,c);throw new Error("Invalid callback!")}if(a.isArray(b)){var e=[],f=arguments.callee;return a.each(b,function(a){e.push(f(a,c,d))}),e}}},j.async=function(b,c,d,e){return d=parseInt(d),a.isNaN(d)&&(d=1),setTimeout(function(){j.callFunc(b,c,e||null)},Math.max(1,d))},j.logArgs=function(){console.log.apply(console,k.apply(arguments))},j.logCb=function(a){return f.apply(null,["log"].concat(k.apply(arguments)))},j.warnArgs=function(){console.warn.apply(console,k.apply(arguments))},j.warnCb=function(a){return f.apply(null,["warn"].concat(k.apply(arguments)))},j.errorArgs=function(){console.error.apply(console,k.apply(arguments))},j.errorCb=function(a){return f.apply(null,["error"].concat(k.apply(arguments)))};var n={},o=!1;return j.isDebugging=function(b){return o||a.isEmpty(b)?o:n.hasOwnProperty(b)&&n[b]},j.debugging=function(b){return a.isEmpty(b)?void(o=!0):void(n[b]=!0)},j.debugComplete=function(b){return a.isEmpty(b)?(o=!1,void(n={})):void delete n[b]},j.onDebugging=function(a,b){j.isDebugging(a)&&j.callFunc(b)},j.getDebugString=function(b,c){var d=[];return a.each(a.castArray(b),function(a){d.push(JSON.stringify(a))}),d.join(c||"\n")},j.optionalArgs=function(b,c,d){var e,f,g,h,i,k,l,m={},n=0;if(g=a.difference(c,Object.keys(d)),g.forEach(function(a){d[a]=!0}),k=c.map(function(a){return d[a]}),a.isEmpty(b))return m;if(b.length>=c.length)m=a.zipObject(c,b.slice(0,c.length));else for(i=b.slice(0);e=i.shift();){if(h=j.contentType(e),l=!1,f=n,j.loop(k.slice(n),function(b,c){return function(d){return d===!0||c===d||a.isArray(d)&&-1!=d.indexOf(c)||a.isFunction(d)&&d(b)?(l=!0,"break"):void n++}}(e,h)),!l){m=a.zipObject(c.slice(0,b.length),b);break}m[c[n++]]=e}return m},j.defineConstant(j,{SORT_NUMBER:g,SORT_NUMBER_DESC:h}),j}),function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Flag=b()}):a.Flag=b()}(this,function(){function a(){this._flags={}}a.prototype.hasFlag=function(a){return this._flags&&this._flags.hasOwnProperty(a)},a.prototype.flag=function(a,b){if(b=b||"undefined"==typeof b?!0:Boolean(b),this._flags||(this._flags={}),a instanceof Array)for(var c=0,d=a.length;d>c;c++)this._flags[a[c]]=b;else if(a instanceof Object)for(var e in a)a.hasOwnProperty(e)&&(this._flags[e]=Boolean(a[e]));else this._flags[a]=b;return this},a.prototype.flagStatus=function(a){return this._flags&&this._flags.hasOwnProperty(a)&&Boolean(this._flags[a])},a.prototype.isFlagged=function(a){return!0===this.flagStatus(a)},a.prototype.toggleFlag=function(a,b){if(a instanceof Array){for(var c in a)this.toggleFlag(a[c],b);return this}return"undefined"!=typeof b?this.flag(a,Boolean(b)):this.flag(a,!this.isFlagged(a)),this},a.prototype.resetFlagStatus=function(){return this._flags={},this},a.mixin=function(b){for(var c=["hasFlag","flag","flagStatus","isFlagged","toggleFlag","resetFlagStatus"],d=0;d<c.length;d++)"function"==typeof b?b.prototype[c[d]]=a.prototype[c[d]]:b[c[d]]=a.prototype[c[d]];return b};for(var b=new a,c=["hasFlag","flag","flagStatus","isFlagged","toggleFlag","resetFlagStatus"],d=0,e=c.length;e>d;d++)a[c[d]]=function(a){return function(){return b[a].apply(b,Array.prototype.slice.call(arguments))}}(c[d]);return a}),function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(a){return b(a)}):a.PreOptions=b(a._)}(this,function(a){function b(){}function c(b,c,e,f,g){if(d.hasOwnProperty(e))throw new Error("Destination Pre Options is already exists");c=a.castArray(c);var h=a.filter(c,function(a){return!d.hasOwnProperty(a)});if(!a.isEmpty(h))throw new Error("PreOptions are not defined:"+h.join(", "));if(a.isObject(f)||(f={}),g)d[e]={options:f,base:c};else{var i={};a.each(c,function(c){a.extend(i,b.get(c))}),a.extend(f,i),d[e]={options:f,base:[]}}}var d={};return b.prototype.define=function(a,b,c){return c||!d.hasOwnProperty(a)?(d[a]={options:b,base:[]},!0):!1},b.prototype.has=function(a){return d.hasOwnProperty(a)},b.prototype.update=function(b,c){return d.hasOwnProperty(b)?(a.extend(d[b].options,c),!0):!1},b.prototype.updateBase=function(a,b){return d.hasOwnProperty(a)?(d[a].base=b,!0):!1},b.prototype.get=function(b,c){if(!d.hasOwnProperty(b))throw new Error('Pre Options "'+b+'" is undefined');var e=this,f={};return a.each(a.castArray(d[b].base),function(b){a.extend(f,e.get(b))}),a.extend(f,a.cloneDeep(d[b].options),a.isObject(c)?c:{}),f},b.prototype.extend=function(a,b,d){c(this,a,b,d,!0)},b.prototype.baseOn=function(a,b,d){c(this,a,b,d,!1)},b.prototype.list=function(b){return b?a.cloneDeep(d):a.keys(d)},b.prototype.reset=function(){d={}},new b}),function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(c){return a.ContentManager=b(c)}):a.ContentManager=b(a._)}(this,function(a){function b(){this.id=a.uniqueId("ContentManager_"),this._contents={},this._usings={}}function c(a,b){var c=b.substr(a.id.length+1).split("_");return c.length>1?c[0]:!1}function d(a,b){return b?a.constructor.name:Object.prototype.toString.call(a)}function e(a){var b=typeof a;if("object"===b){var c=d(a,!0);if(c)return c}return b}var f;f={CONTENT_TYPE_STRING:"string",CONTENT_TYPE_NUMBER:"number",CONTENT_TYPE_BOOLEAN:"boolean",CONTENT_TYPE_ARRAY:"array",CONTENT_TYPE_FUNCTION:"function",CONTENT_TYPE_OBJECT:"object",CONTENT_TYPE_MIXED:"mixed"};for(var g in f)f.hasOwnProperty(g)&&Object.defineProperty(b,g,{enumerable:!0,value:f[g]});return b.prototype.hasType=function(a){return this._contents.hasOwnProperty(a)},b.prototype.types=function(){return Object.keys(this._contents)},b.prototype.keys=function(){var a=this,b={};return Object.keys(this._contents).forEach(function(c){b[c]=Object.keys(a._contents[c])}),b},b.prototype.filter=function(b,c){var d=[],e=this;return c=a.isUndefined(c)?Object.keys(this._contents):a.intersection(a.castArray(c),Object.keys(this._contents)),a.each(c,function(c){a.each(Object.keys(e._contents[c]),function(a){b(e._contents[c][a].content,e._contents[c][a].meta,a,c)&&d.push({type:c,key:a,content:e._contents[c][a].content,meta:e._contents[c][a].meta})})}),d},b.prototype.find=function(b,c){var d,e,f,g,h=!1,i=this;for(c=a.isUndefined(c)?Object.keys(this._contents):a.intersection(a.castArray(c),Object.keys(this._contents));!h&&(d=c.shift());)for(f=Object.keys(i._contents[d]);!h&&(e=f.shift());)g=i._contents[d][e],b(g.content,g.meta,e,d)&&(h={type:d,key:e,content:g.content,meta:g.meta});return h},b.prototype.contentPositions=function(a,b){var c=function(b){return a===b};return this.filter(c,b)},b.prototype.isValidKey=function(a){return!1!==c(this,a)},b.prototype.hasContent=function(a,b){var c=function(b){return a===b};return!1!==this.find(c,b)},b.prototype.has=function(a){if(this.isUsing(a))return!0;var b=c(this,a);return!1!==b?this._contents.hasOwnProperty(b)&&this._contents[b].hasOwnProperty(a):!1},b.prototype.clean=function(){var b=this;a.each(Object.keys(this._contents),function(c){a.isEmpty(b._contents[c])&&delete b._contents[c]})},b.prototype.add=function(b,c,d){d||(d=e(b));var f=a.uniqueId(this.id+"_"+d+"_");return this._contents.hasOwnProperty(d)||(this._contents[d]={}),this._contents[d][f]={content:b,meta:c},f},b.prototype.addUnique=function(a,b,c){c||(c=e(a));var d=this.contentPositions(a,c);return 0==d.length?this.add(a,b,c):d.shift().key},b.prototype.items=function(b,d){var e,f,g,h={};if(g=d?function(a){return a}:function(a){return a.content},a.isEmpty(b)){for(e in this._contents)if(this._contents.hasOwnProperty(e))for(f in this._contents[e])this._contents[e].hasOwnProperty(f)&&(h[f]=g(this._contents[e][f]))}else{var i=a.groupBy(a.castArray(b),a.partial(c,this));for(e in i)i.hasOwnProperty(e)&&a.each(a.pick(this._contents[e],i[e]),function(a,b){h[b]=g(a)})}return h},b.prototype.isUsing=function(a){return this._usings.hasOwnProperty(a)},b.prototype.isUsingContent=function(b,c){var d=this.contentPositions(b,c);return a.isEmpty(d)?!1:!a.isEmpty(a.intersection(a.map(d,"key"),Object.keys(this._usings)))},b.prototype.using=function(b,c){return this.has(b)?(a.isUndefined(c)||c?this._usings[b]=!0:delete this._usings[b],!0):!1},b.prototype.unused=function(b){this._usings=a.omit(this._usings,a.flatten(a.toArray(arguments)))},b.prototype.usingKeys=function(b){return b?a.groupBy(Object.keys(this._usings),a.partial(c,this)):Object.keys(this._usings)},b.prototype.unusedKeys=function(b){var c=this.usingKeys(!0),d={};for(var e in this._contents)this._contents.hasOwnProperty(e)&&(c.hasOwnProperty(e)?d[e]=a.difference(Object.keys(this._contents[e]),c[e]):d[e]=Object.keys(this._contents[e]),a.isEmpty(d[e])&&delete d[e]);return b?d:a.flatten(a.values(d))},b.prototype.get=function(a){var b=c(this,a);return!1!==b&&this._contents[b].hasOwnProperty(a)?this._contents[b][a]:!1},b.prototype.getType=function(a){return this.hasType(a)?this._contents[a]:!1},b.prototype.getContent=function(a,b){var c=this.get(a);return!1!==c?c.content:b},b.prototype.getMeta=function(a,b){var c=this.get(a);return!1!==c?c.meta:b},b.prototype.remove=function(b){var d=[],e=a.groupBy(a.flatten(a.toArray(arguments)),a.partial(c,this));delete e["false"];for(var f in e)if(e.hasOwnProperty(f)&&this._contents.hasOwnProperty(f))for(var g in e[f])e[f].hasOwnProperty(g)&&(d.push({type:f,key:e[f][g]}),delete this._contents[f][e[f][g]],delete this._usings[e[f][g]]);return this.clean(),d},b.prototype.removeContent=function(b,c){var d=this.contentPositions(b,c),e=this;return d.length&&a.each(d,function(a){delete e._contents[a.type][a.key],delete e._usings[a.key]}),this.clean(),d},b.prototype.update=function(a,b,d){if(this.has(a)){var e=c(this,a);return this._contents[e][a].content=b,arguments.length>=3&&(this._contents[e][a].meta=d),!0}return!1},b.prototype.updateMeta=function(a,b){if(this.has(a)){var d=c(this,a);return this._contents[d][a].meta=b,!0}return!1},b.prototype.removeUsing=function(){return this.remove(Object.keys(this._usings))},b.prototype.removeNotUsing=function(){return this.remove(this.unusedKeys())},b.prototype.status=function(){return{using:Object.keys(this._usings),types:this.keys()}},b}),function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Priority=b()}):a.Priority=b()}(this,function(){function a(){this._priorities={},this._key_mapped={}}function b(a,b,c){for(var d,e,f,g,h=[],i=Object.keys(a._priorities);d=i.shift();)for(g=a._priorities[d],e=0,f=g.length;f>e;e++)if(g[e]&&b(g[e].content,g[e].priority_key)){if(!c)return g[e].priority_key;h.push(g[e].priority_key)}return h.length?h:!1}function c(a){return"[object Array]"===h.call(a)}function d(a){return c(a)?a:[a]}var e,f,g=0;f={PRIORITY_HIGHEST:100,PRIORITY_HIGH:250,PRIORITY_DEFAULT:500,PRIORITY_LOW:750,PRIORITY_LOWEST:1e3,PRIORITY_LEVEL_1:100,PRIORITY_LEVEL_2:200,PRIORITY_LEVEL_3:300,PRIORITY_LEVEL_4:400,PRIORITY_LEVEL_5:500,PRIORITY_LEVEL_6:600,PRIORITY_LEVEL_7:700,PRIORITY_LEVEL_8:800,PRIORITY_LEVEL_9:900,PRIORITY_LEVEL_10:1e3};for(e in f)f.hasOwnProperty(e)&&Object.defineProperty(a,e,{enumerable:!0,value:f[e]});a.prototype.hasPriority=function(a){return this._priorities.hasOwnProperty(a+"")},a.prototype.has=function(a){return this._key_mapped.hasOwnProperty(a)},a.prototype.add=function(b,c){var d,e="priority_key_"+ ++g;return"number"==typeof c&&c===c||(c=a.PRIORITY_DEFAULT),this.hasPriority(c)||(this._priorities[c]=[]),d=this._priorities[c].length,this._priorities[c].push({content:b,priority_key:e}),this._key_mapped[e]={priority:c,index:d},e},a.prototype.findAll=function(a){return b(this,function(b){return a===b},!0)},a.prototype.findAllBy=function(a){return b(this,a,!0)},a.prototype.find=function(a){return b(this,function(b){return a===b},!1)},a.prototype.findBy=function(a){return b(this,a,!1)},a.prototype.hasContent=function(a){return!1!==this.find(a)},a.prototype.hasContentBy=function(a){return!1!==this.findBy(a)},a.prototype.addOnce=function(a,b){var c=this.find(a);return!1!==c?c:this.add(a,b)},a.prototype.get=function(a){if(!this.has(a))return!1;var b=this._key_mapped[a];return this._priorities[b.priority][b.index]},a.prototype.update=function(a,b){var c;return this.has(a)?(c=this._key_mapped[a],this._priorities[c.priority][c.index]=b,!0):!1},a.prototype.remove=function(a){var b,c,e,f=[];a=d(a);for(b in a)if(a.hasOwnProperty(b)){if(c=a[b],e=this._key_mapped[c],!e)continue;delete this._key_mapped[c],this._priorities[e.priority][e.index]=void 0,f.push(c)}return f},a.prototype.removeBy=function(a){var b=this.findAllBy(a);return!1===b?[]:this.remove(b)},a.prototype.removeByContent=function(a){return this.removeBy(function(b){return a===b})},a.prototype["export"]=function(a){var b,c,d=[],e=Object.keys(this._priorities);for(e.sort(function(a,b){return a-b});b=e.shift();)for(c in this._priorities[b])this._priorities[b].hasOwnProperty(c)&&(a?d.push({content:this._priorities[b][c].content,priority_key:this._priorities[b][c].priority_key}):d.push(this._priorities[b][c].content));return d};var h=Object.prototype.toString;return a}),function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Waiter=b()}):a.Waiter=b()}(this,function(){function a(){}function b(a){return"[object Array]"===h.call(a)}function c(a){return b(a)?a:[a]}function d(a){var c=[];if(!a.length)return[];for(var e in a)a.hasOwnProperty(e)&&(b(a[e])?c=c.concat(d(a[e])):c.push(a[e]));return c}var e={},f=0,g=Array.prototype.slice;a.prototype.has=function(a){return e.hasOwnProperty(a)&&("number"!=typeof e[a].times||e[a].times>0)},a.prototype.add=function(a,b,c){var d="waiter_key_"+ ++f;return"number"==typeof b?(b=parseInt(b),b=b!==b?1:Math.max(b,1)):b=!0,e[d]={callback:a,times:b,description:c},d},a.prototype.addOnce=function(a,b){return this.add(a,1,b)},a.prototype.createFunc=function(a,b,c){var d=this.add(a,b,c),e=this;return window[d]=function(a){return function(){return e.run.apply(e,[a].concat(g.call(arguments)))}}(d),d},a.prototype.createFuncOnce=function(a,b){return this.createFunc(a,1,b)},a.prototype.remove=function(){var a,b,c=d(g.call(arguments)),f=[];for(b in c)c.hasOwnProperty(b)&&e.hasOwnProperty(c[b])&&(a=c[b],f.push(a),window[a]=void 0,delete e[a],delete window[a]);return f},a.prototype.run=function(a,b,d){var f;if(!this.has(a))throw new Error("Waiter key is non-exists: "+a);return f=e[a].callback.apply(d||null,c(b)),this.has(a)&&"number"==typeof e[a].times&&--e[a].times<1&&this.remove(a),f},a.prototype.list=function(a){var b={};if(a){for(var c in e)e.hasOwnProperty(c)&&(b[c]=e[c].description);return b}return Object.keys(e)};var h=Object.prototype.toString;return new a}),function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(c){return a.EventEmitter=b(c)}):a.EventEmitter=b(a._)}(this,function(a){function b(a){return r.hasOwnProperty(a)||(r[a]=0),a+ ++r[a]}function c(){this.id=b("event_emitter_"),this._events={},this._listeners={},this._listening={},this._mimics={},this._private_events={}}function d(a,b,c,d){return a._listeners.hasOwnProperty(b)&&a._listeners[b].events.hasOwnProperty(c)?(delete a._listeners[b].events[c][d],!0):!1}function e(b,c){return a.isNumber(c)&&(c={priority:c}),c=a.defaults(c||{},{priority:500,times:!0,context:null,key:"",async:!1,delay:1})}function f(b,c){var d=[];return a.each(b._listeners,function(a,b){a.listener===c&&d.push(b)}),d}function g(b){return b=a.castArray(b),a.zipObject(b,a.fill(new Array(b.length),!0))}function h(b,c,d){var e;b._events.hasOwnProperty(c)&&(e=k(b,c),e.length&&a.each(e,function(a){if(a.times===!0||a.times>0){if(a.async?m(a.listener,d,a.context||b,a.delay):l(a.listener,d,a.context||b),a.times===!0)return;if(a.times--,a.times>0)return void(b._events[c][a.event_index_key].times=a.times)}b.removeListener(a.listener_key,c)}))}function i(b,c){return!0===b._private_events||a.isObject(b._private_events)&&b._private_events.hasOwnProperty(c)}function j(b,c,d){return a.isBoolean(b._mimics)?b._mimics:a.isObject(b._mimics)&&b._mimics.hasOwnProperty(c)?!0:d?(d=n(b,a.isObject(d)?d.id:d),!(!d||!(!0===b._listening[d].mimics||a.isObject(b._listening[d].mimics)&&b._listening[d].mimics.hasOwnProperty(c)))):b._mimics.hasOwnProperty(c)}function k(b,c){if(!b._events.hasOwnProperty(c))return[];var d=[];return a.each(b._events[c],function(c,e){b._listeners.hasOwnProperty(c.listener_key)&&(c.listener=b._listeners[c.listener_key].listener,c.event_index_key=e,d.push(a.cloneDeep(c)))}),a.sortBy(d,"priority")}function l(b,c,d){if(c=arguments.length>=2?a.castArray(c):[],b){if(a.isArray(b)){var e=[];return a.each(b,function(a){e.push(a.apply(d||null,c))}),e}if(a.isFunction(b))return b.apply(d||null,c)}}function m(b,c,d,e){return e=parseInt(e),!a.isNaN(e)&&a.isFinite(e)||(e=1),setTimeout(function(){l(b,c,d||null)},Math.max(1,e))}function n(b,c){return b._listening.hasOwnProperty(c)?c:a.findKey(b._listening,["name",c])}function o(b,c,d,e){var f=this;if(b.isListening(f)){var g=b._listening[f.id];if(p(d,g.only,g.except)){var h=Array.prototype.slice.call(arguments,3),i={};i[f.id+"."+d]=!0,i[c+"."+d]=!0,j(b,d,f.id)&&(i[d]=!0),a.each(a.keys(i),function(a){b.emitEvent.apply(b,[a].concat(h))}),b.emitEvent.apply(b,["notified",d].concat(h))}}}function p(a,b,c){return!c.hasOwnProperty(a)&&(!0===b||b.hasOwnProperty(a))}function q(b,c){var d=b._listening[c];d&&(b.emitEvent("before_unlisten",d.target,d),a.isString(d.remove_method)?d.target[d.remove_method](d.listener_key):d.remove_method(d.listener_key),b.emitEvent("unlisten",d.target,d),delete b._listening[c])}var r={};return c.prototype.reset=function(b){b=arguments.length?a.flatten(a.toArray(arguments)):a.keys(this._events);var c=this,e={};return a.each(b,function(b){c._events.hasOwnProperty(b)&&(a.each(c._events[b],function(f,g){d(c,f.listener_key,b,g)&&a.set(e,[f.listener_key,b,g].join("."),!0)}),delete c._events[b])}),a.each(e,function(b,d){a.each(b,function(b,e){c._listeners[d].events[e]=a.omit(c._listeners[d].events[e],a.keys(b)),a.isEmpty(c._listeners[d].events[e])&&delete c._listeners[d].events[e]})}),this},c.prototype.addListener=function(c,d,f){var g,h=this;if(c=a.uniq(a.castArray(c)),f=e(this,f),a.isString(d)){if(!this._listeners.hasOwnProperty(d))throw new Error("Listener is not added");g=d}else g=f.key?f.key:b(this.id+"_listener_"),this._listeners[g]={listener:d,events:{}};return a.each(c,function(b){h._events.hasOwnProperty(b)||(h._events[b]={});var c=h._events[b],d="_"+a.size(c);c[d]=a.extend({},f,{listener_key:g}),h._listeners[g].events.hasOwnProperty(b)||(h._listeners[g].events[b]={}),h._listeners[g].events[b][d]=!0}),g},c.prototype.on=c.prototype.addListener,c.prototype.has=function(b,c){return c=c||a.isUndefined(c),this._listeners.hasOwnProperty(b)&&(!c||!a.isEmpty(this._listeners[b].events))},c.prototype.removeListener=function(b,c){var d,e,g,h=this,i=a.isString(b)?[b]:f(this,b);if(i.length)for(;d=i.shift();)this._listeners.hasOwnProperty(d)&&(e=a.keys(this._listeners[d].events),g=a.isUndefined(c)?e:a.intersection(a.castArray(c),e),a.each(g,function(b){h._events.hasOwnProperty(b)&&(h._events[b]=a.omit(h._events[b],a.keys(h._listeners[d].events[b])),delete h._listeners[d].events[b])}))},c.prototype.removeListeners=function(b,c){var d=this;a.each(b,function(a){d.removeListener(a,c)})},c.prototype.addOnceListener=function(b,c,d){return a.isNumber(d)?d={priority:d}:a.isObject(d)||(d={}),d.times=1,this.addListener(b,c,d)},c.prototype.addListeners=function(b){var c=[],d=this,e=[];return a.isObject(b)&&a.each(b,function(b,d){b=a.castArray(b),a.each(b,function(b){b=a.castArray(b),c.push({name:d,cb:b[0],options:b.length>1?b[1]:{}})})}),a.each(c,function(a){e.push(d.addListener(a.name,a.cb,a.options))}),e},c.prototype.mimic=function(b,c){if(!arguments.length)return void(this._mimics=!0);if(1==arguments.length)return void(a.isBoolean(b)?this._mimics=b:a.isObject(b)&&!a.isArray(b)&&this.isListening(b)?this._listening[n(this,b.id||b)].mimics=!0:(b=a.filter(a.flatten(a.castArray(b)),a.isString),b=g(b),a.isObject(this._mimics)?a.extend(this._mimics,b):this._mimics=b));if(c=n(this,a.isObject(c)?c.id:c),!c)throw new Error("Invalid target");if(a.isBoolean(b)){if(!this.isListening(c))throw new Error("The target is not listening");return void(this._listening[c].mimics=b)}var d=this;b=a.castArray(b),a.each(b,function(b){a.isObject(d._listening[c].mimics)||(d._listening[c].mimics={}),d._listening[c].mimics[b]=!0})},c.prototype.isMimic=function(a,b){return j(this,a,b)},c.prototype["private"]=function(b){a.isBoolean(b)?this._private_events=b?!0:{}:(b=a.filter(a.toArray(arguments),a.isString),a.isObject(this._private_events)||(this._private_events={}),a.extend(this._private_events,g(b)))},c.prototype.emitEvent=function(a,b){b=Array.prototype.slice.call(arguments,1),this._events.hasOwnProperty(a)&&h(this,a,b),this._events.hasOwnProperty("notify")&&!i(this,a)&&h(this,"notify",[a].concat(b)),h(this,a+"_complete",b),"event_emitted"!==a&&h(this,"event_emitted",[a].concat(b))},c.prototype.emit=c.prototype.emitEvent,c.prototype.trigger=c.prototype.emitEvent,c.prototype.emitEventThen=function(a,b,c){c=Array.prototype.slice.call(arguments,2),this.emitEvent.apply(this,[a].concat(c)),b.apply(this,c)},c.prototype.emitThen=c.prototype.emitEventThen,c.prototype.triggerThen=c.prototype.emitEventThen,c.prototype.isListening=function(b,c){var d=a.isObject(b)?b.id:b;return a.isString(d)||a.isNumber(d)&&a.isFinite(d)&&!a.isNaN(d)?!this._listening.hasOwnProperty(d)||a.isObject(b)&&this._listening[d].target!==b?(d=n(this,d),!a.isUndefined(d)):c?p(c,this._listening[d].only,this._listening[d].except):!0:!1},c.prototype.listen=function(b,c,d){if(!a.isObject(b))throw new Error("Listen target must be an object");if(this.isListening(b))return!0;a.isString(c)||(d=c,c=b.id),a.isArrayLike(d)&&(d={only:g(d)}),d=a.defaults(d||{},{target:b,name:c,only:!0,except:{},async:!0,add_method:"addListener",remove_method:"removeListener",event:"notify",mimics:{}}),a.isBoolean(d.mimics)||(d.mimics=g(d.mimics)),a.isBoolean(d.only)||(d.only=g(d.only)),d.except=g(d.except);var e=this,f=function(){o.apply(this,[e,c].concat(Array.prototype.slice.call(arguments)))},h={async:d.async};if(this.emitEvent("before_listen",b,d),a.isString(d.add_method)?d.listener_key=b[d.add_method](d.event,f,h):d.listener_key=d.add_method(this,b,d,f,h),a.isUndefined(d.listener_key)||a.isNull(d.listener_key))throw new Error("Added listener key received by add method is invalid");return this.emitEvent("listen",b,d),this._listening[b.id]=a.omit(d,["async","add_method","event"]),d.listener_key},c.prototype.unlisten=function(b){arguments.length?(b=a.isObject(b)?b.id:b,this.isListening(b)&&q(this,b)):(a.map(a.keys(this._listening),a.partial(q,this)),this._listening={})},c.isEventEmitter=function(a){return a instanceof c},c}),function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(c){return a.Cache=b(c)}):a.Cache=b(a._)}(this,function(a){function b(){j&&clearInterval(j),j=setInterval(h,1e3*i)}function c(b){if(a.has(l,b)){if(l[b].expire_time===!0||l[b].expire_time-1>parseInt(Math.floor(a.now()/1e3)))return!0;e(b)}return!1}function d(c,d,e){!a.isUndefined(e)&&a.isNumber(Number(e))&&a.isFinite(Number(e))||(e=b.CACHE_MEDIUM),l[c]={value:d,live_time:e,expire_time:e===!0?!0:parseInt(Math.floor(a.now()/1e3))+e}}function e(){a.each(a.flatten(arguments),function(a){delete l[a]})}function f(e,f,g){var h=b.CACHE_MEDIUM,i=[];if(a.isUndefined(g)&&(g=!0),c(e)){var j=l[e];if(h=j.live_time,i=j.value,a.isArray(i)||(i=[i]),g)i.push(f);else{var k=a.lastIndexOf(i,f);-1!=k&&i.splice(k,1)}}else{if(!g)return;i.push(f)}return d(e,i,h),l[e].value}function g(b,e,f){return!a.isUndefined(e)&&a.isNumber(Number(e))&&a.isFinite(Number(e))||(e=1),a.isUndefined(f)&&(f=!0),e=f?Math.abs(e):-1*Math.abs(e),c(b)?(l[b].value=Number(l[b].value),a.isNumber(l[b].value)&&a.isFinite(l[b].value)||(l[b].value=0),l[b].value+=e):d(b,e),l[b].value}function h(){var b=[],c=parseInt(Math.floor(a.now()/1e3));a.each(l,function(a,d){a.expire_time!==!0&&a.expire_time<=c&&b.push(d)}),e(b)}var i,j,k,l={};k={CACHE_MIN:10,CACHE_TINY:60,CACHE_SHORT:300,CACHE_MEDIUM:600,CACHE_LONG:3600,CACHE_FOREVER:!0};for(var m in k)k.hasOwnProperty(m)&&Object.defineProperty(b,m,{enumerable:!0,value:k[m]});return i=b.CACHE_MIN,b.prototype.set=function(a,b,c){d(a,b,c)},b.prototype.has=function(a){return c(a)},b.prototype.get=function(b,c){if(a.has(l,b)){if(l[b].expire_time===!0||l[b].expire_time>parseInt(Math.floor(a.now()/1e3)))return l[b].value;delete l[b]}return c},b.prototype.touch=function(b,c){if(this.has(b)){if(l[b].expire_time!==!0){var d=l[b];return a.isNumber(c)&&a.isFinite(c)||(c=d.live_time),d.expire_time=Math.max(d.expire_time,parseInt(Math.floor(a.now()/1e3))+c),d.expire_time}return!0}return!1},b.prototype.list=function(b){var c,d,e=parseInt(Math.floor(a.now()/1e3));return b||a.isUndefined(b)?(c=[],d=function(a){c.push(a)}):(c={},d=function(a,b){c[a]=b}),a.each(l,function(a,b){(a.expire_time===!0||e<a.expire_time)&&d(b,a)}),c},b.prototype.clean=function(){return h()},b.prototype.expire=function(){e(Array.prototype.slice.apply(arguments))},b.prototype.increment=function(b,c){return a.isNumber(c)&&a.isFinite(c)||(c=1),g(b,c,!0)},b.prototype.decrement=function(b,c){return a.isNumber(c)&&a.isFinite(c)||(c=1),g(b,c,!1)},b.prototype.arrayPush=function(a,b){return f(a,b,!0)},b.prototype.arrayWithout=function(a,b){return f(a,b,!1)},new b}),function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(c){return a.Task=b(c)}):a.Task=b(a._)}(this,function(a){function b(b){this.id=a.uniqueId("Task_"),this.name="",this.options={},this.handler=b||null,this._result=null,this._error=null}function c(a,b,c){try{b.bind(a)(c,a.setProcessResult.bind(a),a.setProcessError.bind(a))}catch(d){a.setProcessError(d.message||d.description,d.number||0)}}function d(a,b,c){b.process(c),a._result=b.getResult(),a._error=b.getError()}var e={};return b.prototype.option=function(b,c){var d=this;return a.isObject(b)?a.each(b,function(b,c){a.set(d.options,c,b)}):a.set(this.options,b,c),this},b.prototype.isError=function(){return!a.isNull(this._error)},b.prototype.getError=function(){return this.isError()?a.pick(a.extend({code:0,message:""},a.isObject(this._error)?this._error:{}),"code","message"):null},b.prototype.getResult=function(){return this._result},b.prototype.setProcessResult=function(a){this._result=a,this._error=null},b.prototype.setProcessError=function(a,b){this._result=null,this._error={message:a,code:b||0}},b.prototype.process=function(e){var f=this;return this._result=a.cloneDeep(e),this._error=null,a.isString(this.handler)&&(this.handler=a.castArray(this.handler)),a.isFunction(this.handler)?c(this,this.handler,e):this.handler instanceof b?d(this,this.handler,f._result):a.isArray(this.handler)?a.find(this.handler,function(c){var e;return e=a.isString(c)?b.factory(c):new b(c),d(f,e,f._result),f.isError()}):a.isObject(this.handler)&&a.find(this.handler,function(c,e){var g=b.factory(e);return a.isEmpty(c)||g.options(c),d(f,g,f._result),f.isError()}),!this.isError()},b.isRegistered=function(a){return e.hasOwnProperty(a);
},b.list=function(){return Object.keys(e)},b.register=function(c,d,f){if(a.isObject(c)){if(f=a.isObject(d)?d:{},d=c,!(d instanceof b))throw new Error("Task name is unknown");c=d.name}e[c]={handler:d,options:f||{}}},b.factory=function(c,d){if(b.isRegistered(c)){var f=e[c],g=new b;return g.name=c,g.handler=f.handler,g.options=f.options,a.isObject(d)&&g.option(d),g}throw new Error("Create an unregistered task: "+c)},b.apply=function(c,d){var e={data:a.cloneDeep(c)};if(!a.isEmpty(d)){d=a.castArray(d);var f=[];a.each(d,function(c){a.isString(c)?c=b.factory(c):!a.isObject(c)||c instanceof b||(c=a.extend({task:"",options:{}}),a.isString(c.task)?c.task=b.factory(c.task,c.options):c.task instanceof b&&a.each(options,function(a,b){c.task.option(b,a)}),c=c.task),f.push(c)}),a.find(f,function(b){return b.process(a.cloneDeep(e.data))?void(e.data=b.getResult()):(delete e.data,e.error=b.getError(),!0)})}return e},b.register("DataSource",function(b,c,d){var e=this.options.path;if(!a.isString(e)&&!a.isNumber(e))throw new Error("Path must be string or number");if(a.isString(e)&&a.isEmpty(e))throw new Error("Path is empty");return a.isObject(b)?a.has(b,e)?c(a.get(b,e)):d("Ajax result path not found"):d("Response must be an object")},{path:""}),b}),function(a,b){if("function"==typeof define&&define.amd)define(["lodash","madnh","event_emitter"],function(c,d,e){return a.App=b(c,d,e)});else{var c=b(a._,a.M,a.EventEmitter),d=a.App||null;d&&(_.isArray(d.init_callbacks)&&d.init_callbacks.length&&(_.each(d.init_callbacks,function(a){c.onInit(a)}),d.init_callbacks=[],delete d.init_callbacks),c=_.defaults(c,_.omit(d,"init_callbacks"))),a.App=c}}(this,function(a,b,c){function d(){c.call(this),this["private"]("init")}return b.inherit(d,c),d.prototype.option=function(b,c,d){var e,f={};if(a.isObject(b))f=b,e=a.pick(f,function(b,c){return"_"===(c+"")[0]||a.isFunction(b)}),a.isEmpty(e)||console.warn("Invalid _.App options: "+Object.keys(e).join(", ")),a.extend(this,a.omit(b,Object.keys(e)));else{b+="";var g=b.split(d||".");if("_"===g[0][0])return console.warn("Invalid _.App options: "+g[0][0]),this;a.set(this,g,c)}return this},d.prototype.onInit=function(a,b){return this.addOnceListener("init",a,{priority:b}),this},d.prototype.init=function(){this.emitEvent("init"),this.reset("init")},new d}),function(a,b){"function"==typeof define&&define.amd?define(["lodash","jquery","madnh","pre_options","priority","event_emitter","task"],function(c,d,e,f,g,h,i){return a.Ajax=b(c,d,e,f,g,h,i)}):a.Ajax=b(a._,a.jQuery,a.M,a.PreOptions,a.Priority,a.EventEmitter,a.Task)}(this,function(a,b,c,d,e,f,g){function h(b){f.call(this),this.options=d.get(r.AJAX_PRE_OPTIONS_NAME),this.jqXHR=null,this.requested=0,this.retry_time=0,this._last_options=null,this._is_retrying=!1,this._retry_timeout_id=null,this.response=null,this.error=null,this._is_response_meaning_failed=!1,a.isObject(b)&&this.option(b)}function i(b){var c=g.apply(b,this.options.response_tasks);return c.error?(this._is_response_meaning_failed=!0,this.error=c.error,void(this.isRetryable()||this.emitEvent("fail",c.error.message,c.error.code))):(this.response=c.data,void this.emitEvent("done",a.clone(c.data)))}function j(a,b,c){var d=h.beautifyError(arguments);this.error=d,this.isRetryable()||this.isAborted()||this.emitEvent("fail",d.message,d.code)}function k(a){a._last_options=null,a._is_retrying=!1,a.emitEvent("always",a.error,a.response)}function l(a,b){var c=this;if(this.isAborted())this.emitEvent("aborted");else if(this.isRetryable())return this.isRetrying()&&this.emitEvent("retry_complete",this.retry_time,this.isLastRetryTime(),a,b),this._is_retrying=!0,void(this.options.retry_delay?this._retry_timeout_id=setTimeout(function(){c.request()},this.options.retry_delay):this.request());k(this)}function m(b,c){var d,f=a.extend({},b.options,a.isObject(c)?c:{});if((f.hasOwnProperty("success")||f.hasOwnProperty("done"))&&(b.removeListener("success_listeners_from_options"),b.addListener("done",a.values(a.pick(f,["success","done"])),{priority:e.PRIORITY_HIGHEST,key:"success_listeners_from_options"})),(f.hasOwnProperty("error")||f.hasOwnProperty("fail"))&&(b.removeListener("error_listeners_from_options"),b.addListener("fail",a.values(a.pick(f,["error","fail"])),{priority:e.PRIORITY_HIGHEST,key:"error_listeners_from_options"})),(f.hasOwnProperty("complete")||f.hasOwnProperty("always"))&&(b.removeListener("complete_listeners_from_options"),b.addListener("always",a.values(a.pick(f,["complete","always"])),{priority:e.PRIORITY_HIGHEST,key:"complete_listeners_from_options"})),f.hasOwnProperty("beforeSend")&&(d=f.beforeSend),f=a.omit(f,["success","done","error","fail","complete","always","beforeSend"]),f.done=i.bind(b),f.fail=j.bind(b),f.always=l.bind(b),f.beforeSend=function(c,e){var g=!0;return b.option("auto_abort")&&b.isRequesting()&&b.abort(),a.isFunction(d)&&!b.isRetrying()&&(g=d.apply(b,[c,e])),a.isObject(f.data)||(f.data={}),!1!==g&&(b.requested++,b.error=null,b._is_response_meaning_failed=!1,b.response=null,b.responses=null,b.isRetrying()?(b.retry_time++,b.emitEvent("retry")):(b.retry_time=0,b.emitEvent("request"))),g},!a.isEmpty(f.data_tasks)){var h=g.apply(a.clone(f.data),f.data_tasks);if(!h.data)return this.error=h.error,!1;f.data=h.data}return a.omit(f,["response_tasks","data_tasks","auto_abort","retry","retry_delay","is_continue"])}function n(c,d){var e;return(1==arguments.length||c.isRetrying())&&a.isObject(c._last_options)?e=c._last_options:(e=m(c,d),!1!==e?c._last_options=e:(c.emitEvent("fail",c.error.message,c.error.code),k(c))),e&&(c.jqXHR=b.ajax(a.omit(e,["done","fail","always"])).done(e.done).fail(e.fail).always(e.always)),c}function o(a,b,d,e,f,g){var h,i={url:d,method:(b+"").toUpperCase()};return h=c.optionalArgs(Array.prototype.slice.call(arguments,3),["data","callback","dataType"],{data:["string","Object"],callback:"Function",dataType:"string"}),h.data&&(i.data=h.data),h.callback&&(i.done=h.callback),h.dataType&&(i.dataType=h.dataType),n(a,i)}function p(a,c,d){switch(c=b(c),d){case"append":c.append(a);break;case"prepend":c.prepend(a);break;default:c.html(a)}}var q,r,s={204:"Server has received the request but there is no information to send back",400:"The request had bad syntax or was inherently impossible to be satisfied",401:"The parameter to this message gives a specification of authorization schemes which are acceptable",403:"The request is for something forbidden",404:"The server has not found anything matching the URI given",405:"Method not allowed",406:"Not acceptable",408:"Request timeout",413:"Payload too large",414:"URI too long",429:"Too many requests",431:"Request header fields too large",500:"The server encountered an unexpected condition which prevented it from fulfilling the request",501:"The server does not support the facility required",parser_error:"Parse response failed",aborted:"Manual abort request"};r={AJAX_PRE_OPTIONS_NAME:"MaDnh.Ajax",AJAX_ABORTED:"aborted",AJAX_TIMEOUT:"timeout",AJAX_PARSER_ERROR:"parser_error",AJAX_SERVER_ERROR:500,AJAX_FORBIDDEN:403,AJAX_NOT_FOUND:404},c.inherit(h,f);for(q in r)r.hasOwnProperty(q)&&Object.defineProperty(h,q,{enumerable:!0,value:r[q]});return d.define(r.AJAX_PRE_OPTIONS_NAME,{response_tasks:[],data_tasks:{},auto_abort:!0,retry:0,retry_delay:0,is_continue:!0}),h.globalOption=function(a){d.update(r.AJAX_PRE_OPTIONS_NAME,a)},h.beautifyError=function(a){var b=a[0],c=a[1],d=a[2],e={code:"",message:"Ajax error"};switch(c){case"parsererror":e.code=r.AJAX_PARSER_ERROR;break;case"abort":e.code=r.AJAX_ABORTED;break;default:e.code=b.status}return s.hasOwnProperty(e.code)?e.message=s[e.code]:e.message=d,e},h.prototype.option=function(b,d){return this.options=c.setup.apply(c,[this.options].concat(a.toArray(arguments))),this},h.prototype.data=function(a){return this.options.data=a,this},h.prototype.addData=function(b,c){var d;return this.options.data||(this.options.data={}),a.isObject(arguments[0])?d=a.extend({},b):(d={},arguments.length<2?d[b+""]="true":d[b]=c),a.isObject(this.options.data)?a.extend(this.options.data,d):a.isString(this.options.data)&&(d=a.map(d,function(a,b){return b+"="+a}),this.options.data.length?this.options.data+="&"+d:this.options.data=d),this},h.prototype.done=function(b){return this.on("done",b),this.isSuccess()&&b.apply(this,[a.clone(this.response)]),this},h.prototype.fail=function(a){return this.on("fail",a),this.isFailed()&&a.apply(this,[this.error.message,this.error.code]),this},h.prototype.always=function(a){return this.on("always",a),this.isDone()&&a.apply(this,[this.error,this.response]),this},h.prototype.status=function(){return a.isObject(this.jqXHR)&&this.jqXHR.hasOwnProperty("readyState")?this.jqXHR.readyState:!1},h.prototype.isReady=function(){var a=this.status();return a!==!1&&0===a},h.prototype.isRequesting=function(){var a=this.status();return a!==!1&&a>=1&&3>=a},h.prototype.isRetrying=function(){return Boolean(this._is_retrying)},h.prototype.isDone=function(){return!this.isRetrying()&&4===this.status()},h.prototype.isFailed=function(){return this.isDone()&&!a.isEmpty(this.error)},h.prototype.isResponseMeaningFailed=function(){return this.isFailed()&&this._is_response_meaning_failed},h.prototype.isSuccess=function(){return this.isDone()&&a.isEmpty(this.error)},h.prototype.isAborted=function(){return this.error&&this.error.code===r.AJAX_ABORTED},h.prototype.isLastRetryTime=function(){return this.isRetrying()&&this.options.retry&&this.retry_time>=parseInt(this.options.retry)},h.prototype.isRetryable=function(){if(!a.isEmpty(this.error)&&!this.isAborted()&&!this.isResponseMeaningFailed()&&this.options.retry&&this.retry_time<parseInt(this.options.retry)){var b;return b=a.isFunction(this.options.is_continue)?this.options.is_continue.bind(this)(a.clone(this.error)):Boolean(this.options.is_continue)}return!1},h.prototype.request=function(a){return n(this,a)},h.prototype.abort=function(){this.isRequesting()&&this.jqXHR.abort?this.jqXHR.abort():this.isRetrying()&&(clearTimeout(this._retry_timeout_id),this.emitEvent("aborted"),k(this))},["get","post","put","delete"].forEach(function(a){h.prototype[a]=function(b,c,d,e){return o.apply(null,[this,a.toUpperCase()].concat(Array.prototype.slice.call(arguments,0)))}}),["get","post"].forEach(function(a){h.prototype[a+"JSON"]=function(a,b,d){var e=c.optionalArgs(Array.prototype.slice.call(arguments,0,3),["url","data","callback"],{url:"string",data:["string","Object"],callback:"Function"}),f={dataType:"json"};return e.url&&(f.url=e.url),e.data&&(f.data=e.data),e.callback&&(f.done=e.callback),this.request(f)}}),["get","post","put","delete","getJSON","postJSON"].forEach(function(a){h[a]=function(b,c,d,e){var f=new h;return f[a].apply(f,Array.prototype.slice.call(arguments,0)),f}}),h.prototype.query=function(a){var b={method:"GET"};return a&&(b.data=a),this.request(b)},h.prototype.send=function(a){var b={method:"POST"};return a&&(b.data=a),this.request(b)},h.use=function(a,b){return new h(d.get(a,b))},h.load=function(b,c,d){var e=new h;return a.isObject(d)||(d={}),d=a.extend({error_content:"",apply_type:"replace"},d,{url:b}),e.option(d),e.done(function(a){p(a,c,d.apply_type)}).fail(function(b,f){var g="";d.error_content&&(g=a.isFunction(d.error_content)?d.error_content(e,b,f):d.error_content+""),p(g,c,d.apply_type)}),e.request(),e},h}),function(a,b){"function"==typeof define&&define.amd?define(["lodash","madnhjs","EventEmitter"],function(c,d,e){return a.Template=b(c,d,e)}):a.Template=b(a._,a.M,a.EventEmitter)}(this,function(a,b,c){function d(b,d){this.type_prefix="template",c.call(this),this.dataSource=null,this.options={},this._layout="",this._sections={},a.isUndefined(d)||self.setLayout(d),a.isObject(b)&&a.each(b,function(a,b){self.setSection(a,b)})}function e(a){for(var b,c=new RegExp("@([A-Z0-9_-]+)@","gi"),d=[];null!==(b=c.exec(a));)d.push(b[1]);return d}function f(b,c,d,g){var h="",i=[];h=a.isFunction(b)?b(c,c.dataSource,g):b+"",i=e(h);var j=a.difference(i,Object.keys(d));return a.isEmpty(j)||(console.warn("Missing subsections:",j),a.each(j,function(a){d[a]="",i[a]=""})),i=a.zipObject(i,a.fill(new Array(i.length),"")),a.isEmpty(i)||(a.each(i,function(a,b){d[b]=f(d[b],c,d,g),i[b]=d[b]}),a.each(i,function(a,b){h=h.replace(new RegExp("@"+b.toUpperCase()+"@","gi"),a)})),h}var g="1.0.0";d.prototype=Object.create(c.prototype),d.prototype.constructor=d,Object.defineProperty(d,"version",{value:g}),d.prototype.option=function(c,d){return this.options=b.setup.apply(a.M,[this.options].concat(a.toArray(arguments))),this},d.prototype.connect=function(a){return null!==this.dataSource&&this.disconnect(),this.dataSource=a,a instanceof c&&this.listen(a),this.emitEvent("connected"),this},d.prototype.disconnect=function(){return null!==this.dataSource?(this.emitEvent("before_disconnect"),this.dataSource instanceof c&&this.unlisten(this.dataSource),this.dataSource=null,this.emitEvent("disconnected"),!0):!1},d.prototype.getDataSource=function(){return this.dataSource},d.prototype.isConnected=function(){return null!==this.dataSource},d.prototype.setLayout=function(a){return this._layout=a,this},d.prototype.getLayout=function(){return this._layout},d.prototype.setSection=function(b,c){return a.isObject(b)?a.each(b,function(a,b){this._sections[b.toUpperCase()]=a}.bind(this)):this._sections[b.toUpperCase()]=c,this},d.prototype.currentDraw=function(){return b.currentID(this.id+"_draw",!1)},d.prototype.getDOMID=function(){return this.id},d.prototype.prepareData=function(){return{}},d.prototype.render=function(c){var d,e=this,g=a.extend({},{option:this.options,data_source:this.getDataSource()}),h=a.extend({},this._sections);return b.nextID(this.id+"_draw"),g.draw=this.currentDraw(),g.dom_id=this.getDOMID(),a.extend(g,this.prepareData(g),a.isObject(c)?c:{}),d=a.isFunction(this._layout)?this._layout(e,this.dataSource,g):this._layout+"",d=f(d,this,h,g),a.template(d)(g)},d.prototype.rendered=function(){},d.prototype.reDraw=function(a){var b=this.getDOM();if(b){var c=this.render(a);return this.emitEvent("re-draw"),b.first().replaceWith(c),this.emitEvent("drawn",c),this.rendered(),!0}return!1},d.prototype.getDOM=function(){return $("#"+this.getDOMID())};var h={compilers:{},types:{}};return d.hasCompiler=function(b){return a.has(h.compilers,b)},d.compiler=function(a,b){h.compilers[a]=b},d.compilers=function(){return Object.keys(h.compilers)},d.render=function(a,b){return this.hasCompiler(a)?(1==arguments.length&&(b={}),h.compilers[a](b)):!1},d.register=function(a,b,c){return h.types.hasOwnProperty(a)||(h.types[a]={_default:null,constructors:{}}),h.types[a].hasOwnProperty(b)?!1:(h.types[a].constructors[b]=c,h.types[a]._default||(h.types[a]._default=b),!0)},d.types=function(b){return b?a.mapObject(h.types,function(a){return Object.keys(a.constructors)}):Object.keys(h.types)},d.hasType=function(a){return h.types.hasOwnProperty(a)},d.templates=function(b,c){return c?Object.keys(h.types[b].constructors):a.clone(h.types[b].constructors)},d.hasTemplate=function(a,b){return h.types.hasOwnProperty(a)&&h.types[a].constructors.hasOwnProperty(b)},d.defaultTemplate=function(b,c){if(!a.isEmpty(h.types[b].constructors)){if(c){if(h.types[b].constructors.hasOwnProperty(c))return h.types[b]._default=c,!0;throw new Error("Set default template with invalid template name")}if(h.types[b]._default&&this.hasTemplate(b,h.types[b]._default))return h.types[b]._default;var d=Object.keys(h.types[b].constructors)[0];return h.types[b]._default=d,new h.types[b].constructors[d]}return!1},d.templateInstance=function(a,b){if(arguments.length<2){var c=this.defaultTemplate(a);if(!1!==c)return new h.types[a].constructors[c]}else if(this.hasTemplate(a,b))return new h.types[a].constructors[b];throw new Error("Template with name isn't exists or invalid type")},d});
//# sourceMappingURL=madnh.min.js.map