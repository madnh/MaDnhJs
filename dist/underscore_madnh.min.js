(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)f=F[c],f in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&y>=b};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;return d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){return null!=a?null==b||c?a[0]:s.initial(a,a.length-b):void 0},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){return null!=a?null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b)):void 0},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);h>g;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);e>d;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;c>g&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;b>d;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a?!0:A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,s)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}).call(this),function(a){function b(b,c,d){return d||a.isUndefined(d)?b+"_"+c:c}function c(a,b){return a!==b}function d(a,b){return a!=b}function e(b,e,f){if(arguments.length<2)return{};var g={};return a.isFunction(b)||(b=b?c:d),f=l.mergeObject.apply(l,m.call(arguments,2)),a.each(e,function(a,c){f.hasOwnProperty(c)?b(a,f[c])&&(g[c]=a):g[c]=a}),g}function f(a,b){var c=[];return arguments.length>1&&c.push(b),function(){console[a].apply(console,c.concat(m.apply(arguments)))}}function g(a,b){return a-b}function h(a,b){return b-a}function i(a,b){return a===b}function j(a,b){return a==b}var k="1.2.8",l={};Object.defineProperty(l,"VERSION",{value:k});var m=Array.prototype.slice;a.mixin({module:function(b,c){Object.defineProperty(a,b.toString(),{value:c})}}),a.module("M",l),l.sliceArguments=function(a,b,c){return m.apply(a,m.call(arguments,1))},l.beNumber=function(b,c){return b=parseFloat(b),l.isNumeric(b)?b:a.isUndefined(c)?0:l.isNumeric(c)?parseFloat(c):l.beNumber(c,0)},l.beArray=function(b){return a.isArray(b)?b:[b]},l.beObject=function(b,c){switch(!0){case 1==arguments.length:return a.isObject(b)?b:a.isArray(b)||a.isArguments(b)?a.object(Object.keys(b),b):{0:b};case arguments.length>=2:if(a.isObject(b))return b;var d={};return d[b]=c,d}return{}},l.loop=function(b,c,d){var e,f;if(a.isUndefined(d)&&(d="break"),a.isArray(b))for(e=0,f=b.length;f>e&&c(b[e],e,b)!==d;e++);else{var g=a.keys(b);for(e=0,f=g.length;f>e&&c(b[g[e]],g[e],b)!==d;e++);}return b},l.removeItem=function(b,c){var d=a.flatten(m.call(arguments,1)),e=[],f=Object.keys(b);return 1==d.length&&a.isFunction(d[0])?(b=a.omit(b,d[0]),e=a.difference(f,a.keys(b))):a.each(d,function(c){a.has(b,c)&&(e.push(c),b[c]=void 0,delete b[c])}),e};var n={};l.nextID=function(c,d){return a.isEmpty(c)&&(c="unique_id"),n.hasOwnProperty(c)?n[c]++:n[c]=1,b(c,n[c],d)},l.currentID=function(c,d){return a.isEmpty(c)&&(c="unique_id"),n.hasOwnProperty(c)?b(c,n[c],d):!1},l.resetID=function(b,c){return a.isEmpty(b)&&(b="unique_id"),a.isUndefined(c)?delete n[b]:(c=arguments.length>1?l.beNumber(c):0,c=Math.max(c,0),n[b]=c),c},l.className=function(a,b){return b?a.constructor.name:Object.prototype.toString.call(a)},l.contentType=function(a){var b=typeof a;if("object"===b){var c=l.className(a,!0);if(c)return c}return b},l.isInstanceOf=function(a,b){return this.className(a,!0)===b},l.isPrimitiveType=function(a){var b=typeof a;return null==a||"string"===b||"number"===b||"boolean"===b},l.mergeArray=function(){var b=[];return a.each(arguments,function(c){a.each(c,function(a){b.push(a)})}),b},l.mergeObject=function(){var b={},c=0;return a.each(arguments,function(d){!a.isArray(d)&&a.isObject(d)||(d=l.beArray(d),d=a.object(a.range(c,c+=d.length),d)),a.extend(b,d)}),b},l.diffObject=function(b,d,f){var g=a.toArray(arguments);return g.unshift(c),e.apply(null,g)},l.diffObjectLoose=function(b,c,f){var g=a.toArray(arguments);return g.unshift(d),e.apply(null,g)},l.diffObjectWithCallback=function(a,b,c){return e.apply(null,m.apply(arguments))},l.hasDeep=function(b,c,d){a.isArray(c)||(c=(c+"").split(d||"."));for(var e,f=b;e=c.shift();){if(!f.hasOwnProperty(e))return!1;f=f[e]}return!0},l.defineDeep=function(b,c,d,e){a.isArray(c)||(c=(c+"").split(e||"."));for(var f,g=b,h=c.pop();f=c.shift();)g.hasOwnProperty(f)||(g[f]={}),g=g[f];g[h]=d},l.getDeep=function(b,c,d,e){a.isArray(c)||(c=(c+"").split(e||"."));for(var f,g=b,h=!0;f=c.shift();){if(!g.hasOwnProperty(f)){h=!1;break}g=g[f]}return h?g:d},l.updateDeep=function(b,c,d){if(!l.hasDeep(b,c))throw new Error("Update undefined deep");var e=a.M.getDeep(b,c);l.defineDeep(b,c,d(e))},l.appendDeep=function(b,c,d){l.updateDeep(b,c,function(b){return l.isLikeString(b)?b+=d+"":a.isArray(b)?b.push(d):b=[b,d],b})},l.minMax=function(a,b,c){return Math.max(b,Math.min(a,c))},l.randomString=function(b,c){var d,e,f="";for(!a.isUndefined(c)&&c.toString().length||(c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),d=c.length,b=l.beNumber(b,10),e=b;e>0;--e)f+=c[Math.round(Math.random()*(d-1))];return f},l.randomInteger=function(a,b){0==arguments.length?(a=0,b=10):1==arguments.length&&(b=0);var c=b;return b=Math.max(Math.floor(a),Math.floor(b)),a=Math.min(Math.floor(c),Math.floor(a)),Math.floor(Math.random()*(b-a+1))+a},l.setup=function(b,c,d){switch(a.isObject(b)||(b={}),arguments.length){case 2:a.isObject(c)&&(b=a.extend({},b,c));break;case 3:b[c]=d}return b},l.firstNotEmpty=function(){var b=a.flatten(a.toArray(arguments));return a.find(b,function(b){if(a.isString(b))return b.trim().length>0;if(l.isNumeric(b)){var c=parseFloat(b);return 0!==c&&!a.isNaN(c)&&a.isFinite(c)}return b===!0?!0:!a.isEmpty(b)})},l.pairsAsObject=function(b){var c=[];return a.each(b,function(a,b){c.push({key:b,value:a})}),c},l.pluckBy=function(b,c,d){var e={};return a.each(b,function(a){var b=a.hasOwnProperty(c)?a[c]:void 0,f=a.hasOwnProperty(d)?a[d]:void 0;e[b]=f}),e},l.repeat=function(a,b,c){var d=[];b=Math.max(0,b);for(var e=0;b>e;e++)d.push(a);return c?d:d.join("")},l.span=function(b,c,d,e){return a.isUndefined(e)&&(e=!0),b+="",b.length<c&&(d=l.repeat((d+"").charAt(0),c-b.length),b=e?d+""+b:b+""+d),b},l.left=function(b,c){return a.isUndefined(c)&&(c=1),1>c?"":b.toString().substr(0,c)},l.right=function(b,c){var d=b.toString();return a.isUndefined(c)&&(c=1),1>c?"":d.substr(Math.max(0,d.length-c),c)},l.padNumber=function(a,b,c,d){var e=Math.abs(a).toString(d||10);return e=this.repeat("0",b-e.replace(/\.\d+/,"").length)+e,(c||0>a)&&(e=(0>a?"-":"+")+e),e},l.isNumeric=function(b){return!a.isArray(b)&&b-parseFloat(b)+1>=0},l.isInteger=function(a){return l.isNumeric(a)&&a%1===0},l.isMultiple=function(a,b){try{return a%b===0}catch(c){return!1}},l.isOdd=function(a){return l.isMultiple(a,2)},l.isEven=function(a){return!l.isMultiple(a,2)},l.oneOf=function(b,c,d){return-1!==c.indexOf(b)?b:arguments.length>=3?d:a.first(c)},l.capitalize=function(b,c){return c=a.isUndefined(c)?!0:Boolean(c),b.replace(c?/(^|\s)[a-z]/g:/(^|\s)[a-z]/,function(a){return a.toUpperCase()})},l.isLikeString=function(b){return a.isString(b)||this.isNumeric(b)},l.reverseString=function(a){return a.split("").reverse().join("")},l.isBlank=function(a){return 0===String(a).trim().length},l.nowSecond=function(){return parseInt(Math.floor(a.now()/1e3))},l.escapeURL=function(a,b){return b?encodeURIComponent(a):encodeURI(a)},l.unescapeURL=function(a,b){return b?decodeURI(a):decodeURIComponent(a)},l.escapeHTML=function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2f;").toString()},l.valueAt=function(b,c){l.isLikeString(b)&&(b=(b+"").split("")),a.isArray(b)||(b+="");var d=b.length;return c%=d,0>c&&(c+=d),b[c]},l.chunk=function(b,c){var d=a.groupBy(b,function(a,b){return Math.floor(b/c)});return a.toArray(d)},l.chunks=function(a,b){return l.chunk(a,Math.ceil(a.length/b))},l.toggle=function(b,c,d){if(c=a.uniq(l.beArray(c)),a.isUndefined(d)){var e=a.intersection(b,c),f=a.difference(c,b);b=a.union(a.difference(b,e),f)}else b=d?a.union(b,c):a.difference(b,c);return b},l.defineObject=function(b){var c={};return a.each(b,function(b,d){d=d.trim(),a.has(c,d)||Object.defineProperty(c,d,{enumerable:!a.isFunction(b),value:b})}),c},l.isDefinedConstant=function(b){return a.has(this,b.trim().toUpperCase())},l.defineConstant=function(b,c){var d={},e=[],f=this;return a.isObject(b)?d=b:d[b]=c,a.each(d,function(a,b){b=b.trim().toUpperCase(),l.isDefinedConstant(b)||(Object.defineProperty(f,b,{enumerable:!0,value:a}),e.push(b))}),e},l.inherit=function(b,c,d){var e=b.prototype=Object.create(c.prototype);e.constructor=b,(d||a.isUndefined(d))&&(e._super=c.prototype)},l.callFunc=function(b,c,d){if(c=arguments.length>=2?l.beArray(c):[],b){if(a.isString(b)){if(l.WAITER.has(b))return l.WAITER.run(b,c,d);if(a.has(window,b)&&a.isFunction(window[b]))return window[b].apply(d||window,c);throw new Error("Invalid callback!")}if(a.isFunction(b))return b.apply(d||null,c);if(a.isArray(b)){var e=[],f=arguments.callee;return a.each(b,function(a){e.push(f(a,c,d))}),e}}},l.async=function(b,c,d,e){return d=parseInt(d),a.isNaN(d)&&(d=1),setTimeout(function(){l.callFunc(b,c,e||null)},Math.max(1,d))},l.logArgs=function(){console.log.apply(console,m.apply(arguments))},l.logCb=function(a){return f.apply(null,["log"].concat(m.apply(arguments)))},l.warnArgs=function(){console.warn.apply(console,m.apply(arguments))},l.warnCb=function(a){return f.apply(null,["warn"].concat(m.apply(arguments)))},l.errorArgs=function(){console.error.apply(console,m.apply(arguments))},l.errorCb=function(a){return f.apply(null,["error"].concat(m.apply(arguments)))};var o={},p=!1;l.isDebugging=function(b){return p||a.isEmpty(b)?p:o.hasOwnProperty(b)&&o[b]},l.debugging=function(b){return a.isEmpty(b)?void(p=!0):void(o[b]=!0)},l.debugComplete=function(b){return a.isEmpty(b)?(p=!1,void(o={})):void delete o[b]},l.onDebugging=function(a,b){this.isDebugging(a)&&l.callFunc(b)},l.getDebugString=function(b,c){var d=[];return a.each(l.beArray(b),function(a){d.push(JSON.stringify(a))}),d.join(c||"\n")},l.optionalArgs=function(b,c,d){var e,f,g,h,i,j,k,m={},n=0;if(g=a.difference(c,Object.keys(d)),g.forEach(function(a){d[a]=!0}),j=c.map(function(a){return d[a]}),a.isEmpty(b))return m;if(b.length>=c.length)m=a.object(c,b.slice(0,c.length));else for(i=b.slice(0);e=i.shift();){if(h=l.contentType(e),k=!1,f=n,l.loop(j.slice(n),function(b,c){return function(d){return d===!0||c===d||a.isArray(d)&&-1!=d.indexOf(c)||a.isFunction(d)&&d(b)?(k=!0,"break"):void n++}}(e,h)),!k){m=a.object(c.slice(0,b.length),b);break}m[c[n++]]=e}return m},l.defineConstant({SORT_NUMBER:g,SORT_NUMBER_DESC:h,IS_EQUAL:j,IS_STRICT_EQUAL:i})}(_),function(a){var b={};a.M.FLAG=a.M.defineObject({has:function(c){return a.has(b,c)},flag:function(c,d){d=a.isUndefined(d)?!0:Boolean(d),a.isArray(c)?a.each(c,function(a){b[a]=d}):b[c]=d},flags:function(c){return c?a.clone(b):a.keys(b)},get:function(a){return this.has(a)&&Boolean(b[a])},isFlagged:function(b){var c,d=this;return a.isArray(b)?(c=[],a.each(b,function(a){d.get(a)&&c.push(a)})):c=this.get(b),c},toggle:function(b,c){var d=arguments.callee,e=this;a.isArray(b)?a.each(b,function(a){d.apply(e,[a,c])}):a.isUndefined(c)?this.flag(b,!this.isFlagged(b)):this.flag(b,Boolean(c))},reset:function(){b={}}})}(_),function(a){function b(){this.type_prefix||(this.type_prefix=a.M.className(this,!0)),this.id||(this.id=a.M.nextID(this.type_prefix,!0))}a.M.BaseClass=b}(_),function(a){function b(b,d,e,f){if(c.hasOwnProperty(d))throw new Error("Destination Pre Options is already exists");b=a.M.beArray(b);var g=a.filter(b,function(a){return!c.hasOwnProperty(a)});if(!a.isEmpty(g))throw new Error("PreOptions are not defined:"+g.join(", "));if(a.isObject(e)||(e={}),f)c[d]={options:e,base:b};else{var h={};a.each(b,function(b){a.extend(h,a.M.PreOptions.get(b))}),a.extend(e,h),c[d]={options:e,base:[]}}}var c={};a.M.PreOptions=a.M.defineObject({define:function(a,b,d){return d||!c.hasOwnProperty(a)?(c[a]={options:b,base:[]},!0):!1},has:function(a){return c.hasOwnProperty(a)},update:function(b,d){return c.hasOwnProperty(b)?(a.extend(c[b].options,d),!0):!1},updateBase:function(a,b){return c.hasOwnProperty(a)?(c[a].base=b,!0):!1},get:function(b,d){if(!c.hasOwnProperty(b))throw new Error('Pre Options "'+b+'" is undefined');var e={};return a.each(a.M.beArray(c[b].base),function(b){a.extend(e,a.M.PreOptions.get(b))}),a.extend(e,a.clone(c[b].options),a.isObject(d)?d:{}),e},extend:function(a,c,d){b(a,c,d,!0)},baseOn:function(a,c,d){b(a,c,d,!1)},list:function(b){return b?a.clone(c):Object.keys(c)},reset:function(){c={}}})}(_),function(a){function b(a,b){var c=b.substr(a.id.length+1).split("_");return c.length>1?c[0]:!1}function c(){a.M.BaseClass.call(this),this._contents={},this._usings={}}a.M.defineConstant({CONTENT_TYPE_STRING:"string",CONTENT_TYPE_NUMBER:"number",CONTENT_TYPE_BOOLEAN:"boolean",CONTENT_TYPE_ARRAY:"array",CONTENT_TYPE_FUNCTION:"function",CONTENT_TYPE_OBJECT:"object",CONTENT_TYPE_MIXED:"mixed"}),a.M.inherit(c,a.M.BaseClass),c.prototype.hasType=function(a){return this._contents.hasOwnProperty(a)},c.prototype.types=function(){return Object.keys(this._contents)},c.prototype.keys=function(){var a=this,b={};return Object.keys(this._contents).forEach(function(c){b[c]=Object.keys(a._contents[c])}),b},c.prototype.filter=function(b,c){var d=[],e=this;return c=a.isUndefined(c)?Object.keys(this._contents):a.intersection(a.M.beArray(c),Object.keys(this._contents)),a.M.loop(c,function(c){a.M.loop(Object.keys(e._contents[c]),function(f){b(a.clone(e._contents[c][f].content),a.clone(e._contents[c][f].meta),f,c)&&d.push({type:c,key:f,content:a.clone(e._contents[c][f].content),meta:e._contents[c][f].meta?a.clone(e._contents[c][f].meta):void 0})})}),d},c.prototype.find=function(b,c){var d=!1,e=this;return c=a.isUndefined(c)?Object.keys(this._contents):a.intersection(a.M.beArray(c),Object.keys(this._contents)),a.M.loop(c,function(c){return a.M.loop(Object.keys(e._contents[c]),function(f){var g=e._contents[c][f];return b(a.clone(g.content),a.clone(g.meta),f,c)?(d={type:c,key:f,content:a.clone(g.content),meta:g.meta?a.clone(g.meta):void 0},"break"):void 0}),d?"break":void 0}),d},c.prototype.contentPositions=function(a,b){var c=function(b){return a===b};return this.filter(c,b)},c.prototype.isValidKey=function(a){return!1!==b(this,a)},c.prototype.hasContent=function(a,b){var c=function(b){return a===b};return!1!==this.find(c,b)},c.prototype.has=function(a){if(this.isUsing(a))return!0;var c=b(this,a);return!1!==c?this._contents.hasOwnProperty(c)&&this._contents[c].hasOwnProperty(a):!1},c.prototype.clean=function(){var b=this;a.each(Object.keys(this._contents),function(c){a.isEmpty(b._contents[c])&&delete b._contents[c]})},c.prototype.add=function(b,c,d){d||(d=a.M.contentType(b));var e=a.M.nextID(this.id+"_"+d);return this._contents.hasOwnProperty(d)||(this._contents[d]={}),this._contents[d][e]={content:b,meta:c},e},c.prototype.addUnique=function(b,c,d){d||(d=a.M.contentType(b));var e=this.contentPositions(b,d);return 0==e.length?this.add(b,c,d):e.shift().key},c.prototype.items=function(c,d){var e,f,g,h={};if(g=d?function(b){return a.clone(b)}:function(b){return a.clone(b.content)},a.isEmpty(c)){for(e in this._contents)if(this._contents.hasOwnProperty(e))for(f in this._contents[e])this._contents[e].hasOwnProperty(f)&&(h[f]=g(this._contents[e][f]))}else{var i=a.groupBy(a.M.beArray(c),a.partial(b,this));for(e in i)i.hasOwnProperty(e)&&a.each(a.pick(this._contents[e],i[e]),function(a,b){h[b]=g(a)})}return h},c.prototype.isUsing=function(a){return this._usings.hasOwnProperty(a)},c.prototype.isUsingContent=function(b,c){var d=this.contentPositions(b,c);return a.isEmpty(d)?!1:!a.isEmpty(a.intersection(a.pluck(d,"key"),Object.keys(this._usings)))},c.prototype.using=function(b,c){return this.has(b)?(a.isUndefined(c)||c?this._usings[b]=!0:delete this._usings[b],!0):!1},c.prototype.unused=function(b){this._usings=a.omit(this._usings,a.flatten(a.toArray(arguments)))},c.prototype.usingKeys=function(c){return c?a.groupBy(Object.keys(this._usings),a.partial(b,this)):Object.keys(this._usings)},c.prototype.unusedKeys=function(b){var c=this.usingKeys(!0),d={};for(var e in this._contents)this._contents.hasOwnProperty(e)&&(c.hasOwnProperty(e)?d[e]=a.difference(Object.keys(this._contents[e]),c[e]):d[e]=Object.keys(this._contents[e]),a.isEmpty(d[e])&&delete d[e]);return b?d:a.flatten(a.values(d))},c.prototype.get=function(c){var d=b(this,c);return!1!==d&&this._contents[d].hasOwnProperty(c)?a.clone(this._contents[d][c]):!1},c.prototype.getType=function(b){return this.hasType(b)?a.clone(this._contents[b]):!1},c.prototype.getContent=function(b,c){var d=this.get(b);return!1!==d?a.clone(d.content):c},c.prototype.getMeta=function(b,c){var d=this.get(b);return!1!==d?a.clone(d.meta):c},c.prototype.remove=function(c){
var d=[],e=a.groupBy(a.flatten(a.toArray(arguments)),a.partial(b,this));delete e["false"];for(var f in e)if(e.hasOwnProperty(f)&&this._contents.hasOwnProperty(f))for(var g in e[f])e[f].hasOwnProperty(g)&&(d.push({type:f,key:e[f][g]}),delete this._contents[f][e[f][g]],delete this._usings[e[f][g]]);return this.clean(),d},c.prototype.removeContent=function(b,c){var d=this.contentPositions(b,c),e=this;return d.length&&a.each(d,function(a){delete e._contents[a.type][a.key],delete e._usings[a.key]}),this.clean(),d},c.prototype.update=function(a,c,d){if(this.has(a)){var e=b(this,a);return this._contents[e][a].content=c,arguments.length>=3&&(this._contents[e][a].meta=d),!0}return!1},c.prototype.updateMeta=function(a,c){if(this.has(a)){var d=b(this,a);return this._contents[d][a].meta=c,!0}return!1},c.prototype.removeUsing=function(){return this.remove(Object.keys(this._usings))},c.prototype.removeUnusing=function(){return this.remove(this.unusedKeys())},c.prototype.status=function(){return{using:Object.keys(this._usings),types:this.keys()}},a.M.ContentManager=c}(_),function(a){function b(){this._content_manager=new a.M.ContentManager,this._priorities={}}a.M.defineConstant({PRIORITY_HIGHEST:100,PRIORITY_HIGH:250,PRIORITY_DEFAULT:500,PRIORITY_LOW:750,PRIORITY_LOWEST:1e3,PRIORITY_LEVEL_1:100,PRIORITY_LEVEL_2:200,PRIORITY_LEVEL_3:300,PRIORITY_LEVEL_4:400,PRIORITY_LEVEL_5:500,PRIORITY_LEVEL_6:600,PRIORITY_LEVEL_7:700,PRIORITY_LEVEL_8:800,PRIORITY_LEVEL_9:900,PRIORITY_LEVEL_10:1e3}),b.prototype.hasPriority=function(a){return this._priorities.hasOwnProperty(a)},b.prototype.hasContent=function(a){return this._content_manager.hasContent(a,"priority")},b.prototype.status=function(){var a={priorities:Object.keys(this._priorities).length,contents:0},b=this;return Object.keys(this._priorities).forEach(function(c){a.contents+=b._priorities[c].length}),a},b.prototype.addContent=function(b,c,d){a.isUndefined(c)&&(c=a.M.PRIORITY_DEFAULT);var e=this._content_manager.add(b,d,"priority");return this._content_manager.using(e),a.has(this._priorities,c)||(this._priorities[c]=[]),this._priorities[c].push(e),e},b.prototype.removeContent=function(b,c){var d=this._content_manager.contentPositions(b,"priority"),e=a.pluck(d,"key");return c?this.hasPriority(c)?this.removeKey(a.intersection(e,this._priorities[c])):!1:this.removeKey(e)},b.prototype.removeKey=function(b){var c,d=this;return c=a.pluck(this._content_manager.remove(b),"key"),a.each(Object.keys(this._priorities),function(b){d._priorities[b]=a.difference(d._priorities[b],c)}),c},b.prototype.getContents=function(b){var c=[],d=Object.keys(this._priorities),e=this,f=this._content_manager.getType("priority");return d.sort(a.M.SORT_NUMBER),a.each(d,function(d){var g=a.pick(f,e._priorities[d]);c=b?c.concat(a.pluck(a.values(g),"content")):c.concat(a.values(g))}),c},a.M.Priority=b}(_),function(a){var b={};a.M.WAITER=a.M.defineObject({has:function(a){return b.hasOwnProperty(a)&&b[a].times>0},add:function(c,d,e){var f=a.M.nextID("waiter_key",!0);return b[f]={callback:c,times:a.isUndefined(d)?1:d,description:e||""},f},createFunc:function(b,c,d){var e=this.add(b,c,d),f=this;return window[e]=function(b){return function(){return f.run.apply(f,[b].concat(a.toArray(arguments)))}}(e),e},remove:function(){var c=a.flatten(a.toArray(arguments)),d=[];return a.each(c,function(a){b.hasOwnProperty(a)&&(d.push(a),window[a]=void 0,delete b[a],delete window[a])}),d},run:function(c,d,e){var f;if(!this.has(c))throw new Error("Waiter key is non-exists: "+c);return f=b[c].callback.apply(e||null,a.M.beArray(d)),--b[c].times<1&&this.remove(c),f},list:function(c){if(c){var d={};return a.each(b,function(a,b){d[b]=a.description}),d}return Object.keys(b)}})}(_),function(a){function b(b){a.M.BaseClass.call(this),b=a.defaults(b||{},{limit:a.M.EVENT_EMITTER_EVENT_LIMIT_LISTENERS,events:{},event_mimics:[],event_privates:[]}),this._events={},this._event_emitted={},this._limit=a.M.beNumber(b.limit,a.M.EVENT_EMITTER_EVENT_LIMIT_LISTENERS),this._event_followers={},this._event_following={},this._event_mimics=[],this._event_privates=["attach","attached"],a.isEmpty(b.events)||this.addListeners(a.M.beObject(b.events)),a.isEmpty(b.event_mimics)||this.mimic(a.M.beArray(b.event_mimics)),a.isEmpty(b.event_privates)||this["private"](a.M.beArray(b.event_privates))}function c(b,c,d){var e,f=!1;return b._events.hasOwnProperty(c)&&(e=b._events[c].priority.getContents(),e.length&&(f=!0,a.each(e,function(c){c.meta.async?a.M.async(c.content,d,c.meta.context||b):a.M.callFunc(c.content,d,c.meta.context||b)}))),b._event_emitted.hasOwnProperty(c)?b._event_emitted[c]+=1:b._event_emitted[c]=1,"event_emitted"!==c&&arguments.callee(b,"event_emitted",[c,a.clone(d)]),f}function d(b,c){return"event_emitted"!==c&&-1==b._event_privates.indexOf(c)&&!a.isEmpty(b._event_followers)}function e(b,c,d){a.each(b._event_followers,function(e){function f(a,b,c){e.target.notice(a,b,c)}e.async?a.M.async(f,[b.id,c,d],b):a.M.callFunc(f,[b.id,c,d],b)})}a.M.defineConstant({EVENT_EMITTER_EVENT_LIMIT_LISTENERS:10,EVENT_EMITTER_EVENT_UNLIMITED:-1}),b.prototype.resetEvents=function(a){a?this._events.hasOwnProperty(a)&&(delete this._events[a],delete this._event_emitted[a]):(this._events={},this._event_emitted={})},b.prototype.reset=function(a){return this.resetEvents(a)},b.prototype.events=function(a){if(a){var b={},c=this;return Object.keys(this._events).forEach(function(a){b[a]=c._events[a].priority.status().contents}),b}return Object.keys(this._events)},b.prototype.emitted=function(b){return a.isUndefined(b)?a.clone(this._event_emitted):a.has(this._event_emitted,b)?parseInt(this._event_emitted[b]):0},b.prototype.limit=function(a){this._limit=a+0},b.prototype.unlimited=function(){this._limit=a.M.EVENT_EMITTER_EVENT_UNLIMITED},b.prototype.addListener=function(b,c,d){var e=this;if(a.M.isNumeric(d)&&(d={priority:d}),d=a.defaults(d||{},{priority:a.M.PRIORITY_DEFAULT,times:-1,context:null,key:null,async:!1}),c=a.M.beArray(c),b=a.uniq(a.M.beArray(b)),a.each(b,function(b){if(e._events.hasOwnProperty(b)){if(e._limit!=a.M.EVENT_EMITTER_EVENT_UNLIMITED){var d=e._events[b].priority.status();d.contents+c.length>e._limit&&console.warn("Possible _.M.EventEmitter memory leak detected. "+(d.contents+c.length)+" listeners added (limit is "+e._limit+"). Use emitter.limit() or emitter.unlimited to resolve this warning.")}}else e._events[b]={priority:new a.M.Priority,key_mapped:{}}}),c.length){null===d.key&&(d.key=a.M.nextID("event_emitter_listener",!0));var f=[];return a.each(b,function(b){a.M.loop(c,function(c){d.context&&(c=c.bind(d.context)),-1!=d.times&&(c=a.before(d.times+1,c)),f.push(e._events[b].priority.addContent(c,d.priority,{listener_key:d.key,async:d.async}))}),a.has(e._events[b].key_mapped,d.key)?e._events[b].key_mapped[d.key]=e._events[b].key_mapped[d.key].concat(f):e._events[b].key_mapped[d.key]=f}),d.key}return!1},b.prototype.on=function(a,b,c){return this.addListener.apply(this,arguments)},b.prototype.addOnceListener=function(b,c,d){return a.M.isNumeric(d)?d={priority:d,times:1}:a.isObject(d)||(d={times:1}),this.addListener(b,c,d)},b.prototype.once=function(a,b,c){return this.addOnceListener.apply(this,arguments)},b.prototype.addListeners=function(b){var c=[],d=this;a.isObject(b)&&a.each(b,function(b,d){b=a.M.beArray(b),a.each(b,function(b){b=a.M.beArray(b),c.push({name:d,cb:b[0],options:b.length>1?b[1]:{}})})}),a.each(c,function(a){d.addListener(a.name,a.cb,a.options)})},b.prototype.emitEvent=function(b,f,g){var h=this;a.each(a.M.beArray(b),function(b){h._events.hasOwnProperty(b)&&c(h,b,a.clone(f)),d(h,b)&&e(h,b,a.clone(f)),c(h,b+"_complete",a.clone(f))}),g&&g.call(this)},b.prototype.emit=function(){return this.emitEvent.apply(this,arguments)},b.prototype.removeListener=function(b,c){var d=this;b=a.M.beArray(b),a.each(b,function(b){if(a.M.isLikeString(b))a.each(Object.keys(d._events),function(c){a.has(d._events[c].key_mapped,b)&&(d._events[c].priority.removeKey(d._events[c].key_mapped[b]),delete d._events[c].key_mapped[b],0==d._events[c].priority.status().contents&&delete d._events[c])});else{if(!a.isFunction(b))throw new Error("Invalid remover, it must be key of added listener or listener it self");a.each(Object.keys(d._events),function(a){d._events[a].priority.removeContent(b,c),0==d._events[a].priority.status().contents&&delete d._events[a]})}})},b.prototype.off=function(){return this.removeListener.apply(this,arguments)},b.prototype["private"]=function(){this._event_privates=this._event_privates.concat(a.flatten(a.toArray(arguments)))},b.prototype.mimic=function(){this._event_mimics=this._event_mimics.concat(a.flatten(a.toArray(arguments)))},b.prototype.attach=function(b,c,d,e){if(a.M.isEventEmitter(b))return this._event_followers.hasOwnProperty(b.id)?!1:(this._event_followers[b.id]={target:b,async:a.isUndefined(e)||Boolean(e)},this.emitEvent("attach",[b,c,d]),b.attachTo(this,c,d),!0);throw new Error("Invalid _.M.EventEmitter instance")},b.prototype.attachHard=function(a,b,c){return this.attach(a,b,c,!1)},b.prototype.attachTo=function(b,c,d,e){if(!a.M.isEventEmitter(b))throw new Error("Invalid _.M.EventEmitter instance");return this._event_following.hasOwnProperty(b.id)?!0:(this._event_following[b.id]={id:b.id,type:b.type_prefix,only:a.M.beArray(c||[]),excepts:a.M.beArray(d||[])},this.emitEvent("attached",[b,c,d]),e?b.attachHard(this):b.attach(this))},b.prototype.attachHardTo=function(a,b,c){return this.attachTo(a,b,c,!0)},b.prototype.notice=function(b,c,d){if(this._event_following.hasOwnProperty(b)){var e=this._event_following[b],f=this;if((a.isEmpty(e.only)||-1!==e.only.indexOf(c))&&(a.isEmpty(e.excepts)||-1===e.excepts.indexOf(c))){var g={id:e.id,type:e.type,event:c,data:d},h=[e.id+"."+c,e.type+"."+c,"noticed."+e.id+"."+c,"noticed."+e.id,"noticed."+e.type+"."+c,"noticed."+e.type,"noticed"],i=null;a.M.loop([c,e.type+".*",e.type+"."+c],function(a){return-1!=f._event_mimics.indexOf(a)?(i=a,f.emitEvent(c,d),"break"):void 0}),this.emitEvent(i?a.omit(h,i):h,a.clone(g))}}},b.prototype.detach=function(b){if(a.M.isEventEmitter(b))return this._event_followers.hasOwnProperty(b.id)?(this.emitEvent("detach",[b]),delete this._event_followers[b.id],b.detachFrom(this),!0):!1;throw new Error("Invalid _.M.EventEmitter instance")},b.prototype.detachFrom=function(b){if(a.M.isEventEmitter(b))return this._event_following.hasOwnProperty(b.id)?(this.emitEvent("detached",[b]),delete this._event_following[b.id],b.detach(this),!0):!1;throw new Error("Invalid _.M.EventEmitter instance")},a.M.EventEmitter=b,a.M.isEventEmitter=function(c){return a.isObject(c)?c instanceof b:!1}}(_),function(a){function b(b){if(a.has(i,b)){if(i[b].expire_time===!0||i[b].expire_time-1>a.M.nowSecond())return!0;d(b)}return!1}function c(b,c,d){!a.isUndefined(d)&&a.M.isNumeric(Number(d))||(d=a.M.CACHE_MEDIUM),i[b]={value:c,live_time:d,expire_time:d===!0?!0:a.M.nowSecond()+d}}function d(){a.each(a.flatten(arguments),function(a){delete i[a]})}function e(d,e,f){var g=a.M.CACHE_MEDIUM,h=[];if(a.isUndefined(f)&&(f=!0),b(d)){var j=i[d];if(g=j.live_time,h=j.value,a.isArray(h)||(h=[h]),f)h.push(e);else{var k=a.lastIndexOf(h,e);-1!=k&&h.splice(k,1)}}else{if(!f)return;h.push(e)}return c(d,h,g),i[d].value}function f(d,e,f){return!a.isUndefined(e)&&a.M.isNumeric(Number(e))||(e=1),a.isUndefined(f)&&(f=!0),e=f?Math.abs(e):-1*Math.abs(e),b(d)?(i[d].value=Number(i[d].value),a.M.isNumeric(i[d].value)||(i[d].value=0),i[d].value+=e):c(d,e),i[d].value}function g(){var b=[],c=a.M.nowSecond();a.each(i,function(a,d){a.expire_time!==!0&&a.expire_time<=c&&b.push(d)}),d(b)}a.M.defineConstant({CACHE_MIN:10,CACHE_TINY:60,CACHE_SHORT:300,CACHE_MEDIUM:600,CACHE_LONG:3600,CACHE_FOREVER:!0});var h,i={},j=a.M.CACHE_MIN;h=setInterval(g,1e3*j),a.M.CACHE=a.M.defineObject({set:function(a,b,d){c(a,b,d)},has:function(a){return b(a)},get:function(b,c){if(a.has(i,b)){if(i[b].expire_time===!0||i[b].expire_time>a.M.nowSecond())return i[b].value;delete i[b]}return c},touch:function(b,c){if(this.has(b)){if(i[b].expire_time!==!0){var d=i[b];return a.M.isNumeric(c)||(c=d.live_time),d.expire_time=Math.max(d.expire_time,a.M.nowSecond()+c),d.expire_time}return!0}return!1},list:function(b){var c,d,e=a.M.nowSecond();return b||a.isUndefined(b)?(c=[],d=function(a){c.push(a)}):(c={},d=function(a,b){c[a]=b}),a.each(i,function(a,b){(a.expire_time===!0||e<a.expire_time)&&d(b,a)}),c},clean:function(){return g()},expire:function(){d(Array.prototype.slice.apply(arguments))},increment:function(b,c){return a.M.isNumeric(c)||(c=1),f(b,c,!0)},decrement:function(b,c){return a.M.isNumeric(c)||(c=1),f(b,c,!1)},arrayPush:function(a,b){return e(a,b,!0)},arrayWithout:function(a,b){return e(a,b,!1)}})}(_),function(a){function b(b){this.type_prefix="task",a.M.BaseClass.call(this),this.name="",this.options={},this.handler=b||null,this._result=null,this._error=null}var c={};b.prototype.option=function(b,c){return this.options=a.M.setup.apply(a.M,[this.options].concat(Array.prototype.slice.apply(arguments))),this},b.prototype.isError=function(){return this._error},b.prototype.getError=function(){return this.isError()?a.pick(a.extend({code:0,message:""},a.isObject(this._error)?this._error:{}),"code","message"):void 0},b.prototype.getResult=function(){return this._result},b.prototype.setProcessResult=function(a){this._result=a,this._error=null},b.prototype.setProcessError=function(a,b){this._result=null,this._error={message:a,code:b||0}},b.prototype.process=function(c){var d=this;return this._result=a.clone(c),this._error=null,a.isString(this.handler)&&(this.handler=a.M.beArray(this.handler)),a.isFunction(this.handler)?this.handler.bind(this)(c,this.setProcessResult.bind(this),this.setProcessError.bind(this)):this.handler instanceof b?(this.handler.process(d._result),d._result=this.handler.getResult(),d._error=this.handler.getError()):a.isArray(this.handler)?a.M.loop(this.handler,function(c){var e;return e=a.isString(c)?b.factory(c):new b(c),e.process(d._result),d._result=e.getResult(),d._error=e.getError(),d.isError()?"break":void 0}):a.isObject(this.handler)&&a.M.loop(this.handler,function(c,e){var f=b.factory(e);return a.isEmpty(c)||f.options(c),f.process(d._result),d._result=f.getResult(),d._error=f.getError(),d.isError()?"break":void 0}),!this.isError()},b.has=function(a){return c.hasOwnProperty(a)},b.list=function(){return Object.keys(c)},b.register=function(d,e,f){var g=a.M.optionalArgs(Array.prototype.slice.call(arguments,0),["name","handler","options"],{name:"string",handler:["string","function","array","Task"],options:"object"});g.handler instanceof b&&(g.name=g.handler.name),c[g.name]={handler:g.handler,options:g.options}},b.factory=function(d,e){if(b.has(d)){var f=c[d],g=new b;return g.name=d,g.handler=f.handler,g.options=f.options,a.isObject(e)&&g.option(e),g}throw new Error("Create unregistered task: "+d)},b.apply=function(c,d){var e={data:a.clone(c)};return d&&(a.isString(d)&&(d=[d]),a.isArray(d)&&(d=a.object(d,a.M.repeat({},d.length,!0))),a.M.loop(d,function(c,d){var f=b.factory(d,c);return f.process(a.clone(e.data))?void(e.data=f.getResult()):(delete e.data,e.error=f.getError(),"break")})),e},a.M.Task=b}.call(window,_),function(a){function b(){a.M.EventEmitter.call(this),this["private"]("init")}a.M.inherit(b,a.M.EventEmitter),b.prototype.option=function(b,c,d){var e,f={};if(a.isObject(b))f=b,e=a.pick(f,function(b,c){return"_"===(c+"")[0]||a.isFunction(b)}),a.isEmpty(e)||console.warn("Invalid _.App options: "+Object.keys(e).join(", ")),a.extend(this,a.omit(b,Object.keys(e)));else{b+="";var g=b.split(d||".");if("_"===g[0][0])return console.warn("Invalid _.App options: "+g[0][0]),this;a.M.defineDeep(this,g,c)}return this},b.prototype.onInit=function(b,c,d){return this.addListener("init",b,{times:c||1,priority:d||a.M.PRIORITY_DEFAULT}),this},b.prototype.init=function(a){this.emitEvent("init"),a&&this.resetEvents("init")},b.prototype.resetInitCallbacks=function(){this.resetEvents("init")},a.module("App",new b)}(_),function(a){function b(b){a.M.EventEmitter.call(this),this.options=a.M.PreOptions.get(a.M.AJAX_PRE_OPTIONS_NAME),this.jqXHR=null,this.requested=0,this.retry_time=0,this._last_options=null,this._is_retrying=!1,this._retry_timeout_id=null,this.response=null,this.error=null,this._is_response_meaning_failed=!1,a.isObject(b)&&this.option(b)}function c(b){var c=a.M.Task.apply(b,this.options.response_tasks);return c.error?(this._is_response_meaning_failed=!0,this.error=c.error,void(this.isRetryable()||this.emitEvent("fail",[c.error.message,c.error.code]))):(this.response=c.data,void this.emitEvent("done",[a.clone(c.data)]))}function d(a,c,d){var e=b.beautifyError(arguments);this.error=e,this.isRetryable()||this.isAborted()||this.emitEvent("fail",[e.message,e.code])}function e(b){b._last_options=null,b._is_retrying=!1,b.emitEvent("always",[b.error,b.response]),a.App&&a.App.emitEvent("ajax_complete",[b])}function f(b,c){var d=this;if(this.isAborted())this.emitEvent("aborted");else if(this.isRetryable())return this.isRetrying()&&(this.emitEvent("retry_complete",[this.retry_time,this.isLastRetryTime(),b,c]),a.App&&a.App.emitEvent("ajax_retry_complete",[this,this.retry_time,this.isLastRetryTime(),b,c])),this._is_retrying=!0,void(this.options.retry_delay?this._retry_timeout_id=a.M.async(function(){d.request()},[],this.options.retry_delay):this.request());e(this)}function g(b,e){var g,h=a.extend({},b.options,a.isObject(e)?e:{});if((h.hasOwnProperty("success")||h.hasOwnProperty("done"))&&(b.removeListener("success_listeners_from_options"),b.addListener("done",a.values(a.pick(h,["success","done"])),{priority:a.M.PRIORITY_HIGHEST,key:"success_listeners_from_options"})),(h.hasOwnProperty("error")||h.hasOwnProperty("fail"))&&(b.removeListener("error_listeners_from_options"),b.addListener("fail",a.values(a.pick(h,["error","fail"])),{priority:a.M.PRIORITY_HIGHEST,key:"error_listeners_from_options"})),(h.hasOwnProperty("complete")||h.hasOwnProperty("always"))&&(b.removeListener("complete_listeners_from_options"),b.addListener("always",a.values(a.pick(h,["complete","always"])),{priority:a.M.PRIORITY_HIGHEST,key:"complete_listeners_from_options"})),h.hasOwnProperty("beforeSend")&&(g=h.beforeSend),a.M.removeItem(h,["success","done","error","fail","complete","always","beforeSend"]),h.done=c.bind(b),h.fail=d.bind(b),h.always=f.bind(b),h.beforeSend=function(c,d){var e=!0;return b.option("auto_abort")&&b.isRequesting()&&b.abort(),a.isFunction(g)&&!b.isRetrying()&&(e=a.M.callFunc(g,[c,d],b)),a.isObject(h.data)||(h.data={}),!1!==e&&(b.requested++,b.error=null,b._is_response_meaning_failed=!1,b.response=null,b.responses=null,b.isRetrying()?(b.retry_time++,b.emitEvent("retry")):(b.retry_time=0,b.emitEvent("request"))),e},!a.isEmpty(h.data_tasks)){var i=a.M.Task.apply(a.clone(h.data),h.data_tasks);if(!i.data)return this.error=i.error,!1;h.data=i.data}return a.M.removeItem(h,["response_tasks","data_tasks","auto_abort","retry","retry_delay","is_continue"]),h}function h(b,c){var d;return(1==arguments.length||b.isRetrying())&&a.isObject(b._last_options)?d=b._last_options:(d=g(b,c),!1!==d?b._last_options=d:(b.emitEvent("fail",[b.error.message,b.error.code]),e(b))),d&&(b.jqXHR=$.ajax(a.omit(d,["done","fail","always"])).done(d.done).fail(d.fail).always(d.always)),b}function i(b,c,d,e,f,g){var i,j={url:d,method:(c+"").toUpperCase()};return i=a.M.optionalArgs(Array.prototype.slice.call(arguments,3),["data","callback","dataType"],{data:["string","object"],callback:"function",dataType:"string"}),i.data&&(j.data=i.data),i.callback&&(j.done=i.callback),i.dataType&&(j.dataType=i.dataType),h(b,j)}function j(a,b,c){switch(b=$(b),c){case"append":b.append(a);break;case"prepend":b.prepend(a);break;default:b.html(a)}}a.M.defineConstant({AJAX_PRE_OPTIONS_NAME:"_.M.AJAX",AJAX_ABORTED:"aborted",AJAX_TIMEOUT:"timeout",AJAX_PARSER_ERROR:"parser_error",AJAX_SERVER_ERROR:500,AJAX_FORBIDDEN:403,AJAX_NOT_FOUND:404});var k={204:"Server has received the request but there is no information to send back",400:"The request had bad syntax or was inherently impossible to be satisfied",401:"The parameter to this message gives a specification of authorization schemes which are acceptable",403:"The request is for something forbidden",404:"The server has not found anything matching the URI given",405:"Method not allowed",406:"Not acceptable",408:"Request timeout",413:"Payload too large",414:"URI too long",429:"Too many requests",431:"Request header fields too large",500:"The server encountered an unexpected condition which prevented it from fulfilling the request",501:"The server does not support the facility required",parser_error:"Parse response failed",aborted:"Manual abort request"};a.M.PreOptions.define(a.M.AJAX_PRE_OPTIONS_NAME,{response_tasks:{},data_tasks:{},auto_abort:!0,retry:0,retry_delay:0,is_continue:!0}),a.M.inherit(b,a.M.EventEmitter),b.globalOption=function(b){a.M.PreOptions.update(a.M.AJAX_PRE_OPTIONS_NAME,b)},b.beautifyError=function(b){var c=b[0],d=b[1],e=b[2],f={code:"",message:"Ajax error"};switch(d){case"parsererror":f.code=a.M.AJAX_PARSER_ERROR;break;case"abort":f.code=a.M.AJAX_ABORTED;break;default:f.code=c.status}return k.hasOwnProperty(f.code)?f.message=k[f.code]:f.message=e,f},b.prototype.option=function(b,c){return this.options=a.M.setup.apply(a.M,[this.options].concat(Array.prototype.slice.apply(arguments))),this},b.prototype.data=function(a){return this.options.data=a,this},b.prototype.addData=function(b,c){var d;return this.options.data||(this.options.data={}),a.isObject(arguments[0])?d=a.extend({},b):(d={},arguments.length<2?d[b+""]="true":d[b]=c),a.isObject(this.options.data)?a.extend(this.options.data,d):a.isString(this.options.data)&&(d=a.map(d,function(a,b){return b+"="+a}),this.options.data.length?this.options.data+="&"+d:this.options.data=d),this},b.prototype.done=function(b){return this.on("done",b),this.isSuccess()&&b.apply(this,[a.clone(this.response)]),this},b.prototype.fail=function(a){return this.on("fail",a),this.isFailed()&&a.apply(this,[this.error.message,this.error.code]),this},b.prototype.always=function(a){return this.on("always",a),this.isDone()&&a.apply(this,[this.error,this.response]),this},b.prototype.status=function(){return a.isObject(this.jqXHR)&&this.jqXHR.hasOwnProperty("readyState")?this.jqXHR.readyState:!1},b.prototype.isReady=function(){var a=this.status();return a!==!1&&0===a},b.prototype.isRequesting=function(){var a=this.status();return a!==!1&&a>=1&&3>=a},b.prototype.isRetrying=function(){return Boolean(this._is_retrying)},b.prototype.isDone=function(){return!this.isRetrying()&&4===this.status()},b.prototype.isFailed=function(){return this.isDone()&&!a.isEmpty(this.error)},b.prototype.isResponseMeaningFailed=function(){return this.isFailed()&&this._is_response_meaning_failed},b.prototype.isSuccess=function(){return this.isDone()&&a.isEmpty(this.error)},b.prototype.isAborted=function(){return this.error&&this.error.code===a.M.AJAX_ABORTED},b.prototype.isLastRetryTime=function(){return this.isRetrying()&&this.options.retry&&this.retry_time>=parseInt(this.options.retry)},b.prototype.isRetryable=function(){if(!a.isEmpty(this.error)&&!this.isAborted()&&!this.isResponseMeaningFailed()&&this.options.retry&&this.retry_time<parseInt(this.options.retry)){var b;return b=a.isFunction(this.options.is_continue)?this.options.is_continue.bind(this)(a.clone(this.error)):Boolean(this.options.is_continue)}return!1},b.prototype.request=function(a){return h(this,a)},b.prototype.abort=function(){this.isRequesting()&&this.jqXHR.abort?this.jqXHR.abort():this.isRetrying()&&(clearTimeout(this._retry_timeout_id),this.emitEvent("aborted"),e(this))},["get","post","put","delete"].forEach(function(a){b.prototype[a]=function(b,c,d,e){return i.apply(null,[this,a.toUpperCase()].concat(Array.prototype.slice.call(arguments,0)))}}),["get","post"].forEach(function(c){b.prototype[c+"JSON"]=function(b,c,d){var e=a.M.optionalArgs(Array.prototype.slice.call(arguments,0,3),["url","data","callback"],{url:"string",data:["string","object"],callback:"function"}),f={dataType:"json"};return e.url&&(f.url=e.url),e.data&&(f.data=e.data),e.callback&&(f.done=e.callback),this.request(f)}}),["get","post","put","delete","getJSON","postJSON"].forEach(function(a){b[a]=function(c,d,e,f){var g=new b;return g[a].apply(g,Array.prototype.slice.call(arguments,0)),g}}),b.prototype.query=function(a){var b={method:"GET"};return a&&(b.data=a),this.request(b)},b.prototype.send=function(a){var b={method:"POST"};return a&&(b.data=a),this.request(b)},b.use=function(c,d){return new b(a.M.PreOptions.get(c,d))},b.load=function(c,d,e){var f=new b;return a.isObject(e)||(e={}),e=a.extend({error_content:"",apply_type:"replace"},e,{url:c}),f.option(e),f.done(function(a){j(a,d,e.apply_type)}).fail(function(b,c){var g="";e.error_content&&(g=a.isFunction(e.error_content)?e.error_content(f,b,c):e.error_content+""),j(g,d,e.apply_type)}),f.request(),f},a.M.AJAX=b}(_);
//# sourceMappingURL=underscore_madnh.min.js.map