!function(a){function b(a,b){var c=[];return arguments.length>1&&c.push(b),function(){console[a].apply(console,c.concat(g.apply(arguments)))}}function c(a,b){return a-b}function d(a,b){return b-a}var e="1.0.0",f={};Object.defineProperty(f,"VERSION",{value:e});var g=Array.prototype.slice;a.mixin({module:function(b,c){Object.defineProperty(a,b.toString(),{value:c})}}),a.module("M",f),f.loop=function(b,c,d){var e,f;if(a.isUndefined(d)&&(d="break"),a.isArray(b))for(e=0,f=b.length;f>e&&c(b[e],e,b)!==d;e++);else{var g=a.keys(b);for(e=0,f=g.length;f>e&&c(b[g[e]],g[e],b)!==d;e++);}return b},f.removeItem=function(b,c){var d=g.call(arguments,1),e=[],f=Object.keys(b);return 1==d.length&&a.isFunction(d[0])?(b=a.omit(b,d[0]),e=a.difference(f,a.keys(b))):a.each(d,function(c){a.has(b,c)&&(e.push(c),b[c]=void 0,delete b[c])}),e};var h={};f.nextID=function(b,c){a.isEmpty(b)&&(b="unique_id"),a.has(h,b)||(h[b]=0);var d=h[b]++;return c||a.isUndefined(c)?b+"_"+d:d},f.currentID=function(b,c){var d=0;return a.isEmpty(b)&&(b="unique_id"),a.has(h,b)&&(d=h[b]-1),c||a.isUndefined(c)?b+"_"+d:d},f.className=function(a,b){return b?a.constructor.name:Object.prototype.toString.call(a)},f.contentType=function(b){var c=typeof b;if("object"===c)switch(!0){case a.isArray(b):return"array";case a.isFunction(b):return"function";default:return f.className(b,!0)}return c},f.isInstanceOf=function(a,b){return this.className(a,!0)===b},f.isPrimitiveType=function(a){var b=typeof a;return null==a||"string"===b||"number"===b||"boolean"===b},f.asArray=function(b){return a.isArray(b)?b:[b]},f.asObject=function(b,c){switch(!0){case 1==arguments.length:return a.isObject(b)?b:{};case arguments.length>=2:if(a.isObject(b))return b;var d={};return d[b]=c,d}return{}},f.minMax=function(a,b,c){return Math.max(b,Math.min(a,c))},f.randomString=function(b,c){var d,e,f="";for(!a.isUndefined(c)&&c.toString().length||(c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),d=c.length,e=b;e>0;--e)f+=c[Math.round(Math.random()*(d-1))];return f},f.setup=function(b,c,d){switch(a.isObject(b)||(b={}),arguments.length){case 2:a.isObject(c)&&(b=a.extend({},b,c));break;case 3:b[c]=d}return b},f.firstNotEmpty=function(){return a.find(a.flatten(g.call(arguments,0)),function(b){if(a.isString(b))return b.length>0;if(f.isNumeric(b)){var c=parseFloat(b);return 0!==c&&!a.isNaN(parseFloat(b))&&!a.isFinite(c)}return b===!0?!0:!a.isEmpty(b)})},f.repeat=function(a,b,c){var d=[];b=Math.max(0,b);for(var e=0;b>e;e++)d.push(a);return c?d:d.join("")},f.span=function(b,c,d,e){return a.isUndefined(e)&&(e=!0),b+="",b.length<c&&(d=f.repeat(d,c-b.length),b=e?d+""+b:b+""+d),b},f.left=function(b,c){return a.isUndefined(c)&&(c=1),0>=c?"":b.toString().substr(0,c)},f.right=function(b,c){var d=b.toString();return a.isUndefined(c)&&(c=1),0>=c?"":d.substr(Math.max(0,d.length-c),c)},f.padNumber=function(a,b,c,d){var e=Math.abs(a).toString(d||10);return e=this.repeat("0",b-e.replace(/\.\d+/,"").length)+e,(c||0>a)&&(e=(0>a?"-":"+")+e),e},f.isNumeric=function(b){return!a.isArray(b)&&b-parseFloat(b)+1>=0},f.isInteger=function(a){return a%1===0},f.isMultiple=function(a,b){return a%b===0},f.isOdd=function(a){return f.isInteger(a)&&!f.isMultiple(a,2)},f.isEven=function(a){return this.isMultiple(a,2)},f.oneOf=function(b,c){return-1==b.indexOf(c)?a.first(b):c},f.capitalize=function(a,b){var c;return a.toLowerCase().replace(b?/[^']/g:/^\S/,function(a){var b,d=a.toUpperCase();return b=c?a:d,c=d!==a,b})},f.isLikeString=function(b){return a.isString(b)||this.isNumeric(b)},f.reverseString=function(a){return a.split("").reverse().join("")},f.isBlank=function(a){return 0===a.trim().length},f.nowSecond=function(){return parseInt(Math.floor(a.now()/1e3))},f.escapeURL=function(a,b){return b?encodeURIComponent(a):encodeURI(a)},f.unescapeURL=function(a,b){return b?decodeURI(a):decodeURIComponent(a)},f.escapeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2f;").toString()},f.valueAt=function(b,c){a.isString(b)&&(b=b.split("")),a.isArray(b)||(b+="");var d=b.length;return c%=d,0>c&&(c+=d),b[c]},f.chunk=function(b,c){var d=a.groupBy(b,function(a,b){return Math.floor(b/c)});return a.toArray(d)},f.chunks=function(a,b){return f.chunk(a,Math.ceil(a.length/b))},f.toggle=function(b,c,d){if(c=a.uniq(a.asArray(c)),a.isUndefined(d)){var e=a.intersection(b,c),f=a.difference(c,b);b=a.union(a.difference(b,e),f)}else b=d?a.union(b,c):a.difference(b,c);return b},f.defineObject=function(b){var c={};return a.each(b,function(b,d){d=d.trim(),a.has(c,d)||Object.defineProperty(c,d,{enumerable:!a.isFunction(b),value:b})}),c},f.isDefinedConstant=function(b){return a.has(this,b.trim().toUpperCase())},f.defineConstant=function(b,c){var d={},e=[],g=this;return a.isObject(b)?d=b:d[b]=c,a.each(d,function(a,b){b=b.trim().toUpperCase(),f.isDefinedConstant(b)||(Object.defineProperty(g,b,{enumerable:!0,value:a}),e.push(b))}),e},f.inherit=function(a,b,c){var d=a.prototype=Object.create(b.prototype);d.constructor=a,(c||"undefined"==typeof c)&&(a._super=b.prototype)},f.callFunc=function(b,c,d){if(d=arguments.length>2?3==arguments.length?f.asArray(d):g.apply(arguments,2):[],c){if(a.isString(c)){if(f.WAITER.has(c))return f.WAITER.run(c,d,b);if(a.has(window,c)&&a.isFunction(window[c]))return window[c].apply(b||window,d);throw new Error("Invalid callback!")}if(a.isFunction(c))return c.apply(b,d);if(a.isArray(c)){var e=[],h=arguments.callee;return a.each(c,function(a){e.push(h(b,a,d))}),e}}},f.async=function(b,c,d,e){e=parseInt(e),a.isNaN(e)&&(e=1),setTimeout(function(){f.callFunc(b,c,d)},Math.max(1,e))},f.logArgs=function(){console.log.apply(console,g.apply(arguments))},f.logCb=function(a){return b.apply(null,["log"].concat(g.apply(arguments)))},f.warnArgs=function(){console.warn.apply(console,g.apply(arguments))},f.warnCb=function(a){return b.apply(null,["warn"].concat(g.apply(arguments)))},f.errorArgs=function(){console.error.apply(console,g.apply(arguments))},f.errorCb=function(a){return b.apply(null,["error"].concat(g.apply(arguments)))},f.defineConstant({SORT_NUMBER:c,SORT_NUMBER_DESC:d})}(_),function(a){var b={};a.M.FLAG=a.M.defineObject({has:function(c){return a.has(b,c)},flag:function(c,d,e,f){d=a.isUndefined(d)?!0:Boolean(d),a.isString(e)||a.M.isNumeric(e)?e+="":e="",a.isString(f)||a.M.isNumeric(f)?f+="":f="",a.isArray(c)?a.each(c,function(a){b[e+a+f]=d}):b[e+c+f]=d},flags:function(c){return c?a.clone(b):a.keys(b)},get:function(a){return this.has(a)&&Boolean(b[a])},isFlagged:function(b,c,d){var e,f=this;return a.isString(c)||a.M.isNumeric(c)?c+="":c="",a.isString(d)||a.M.isNumeric(d)?d+="":d="",a.isArray(b)?(e=[],a.each(b,function(a){f.get(c+a+d)&&e.push(a)})):e=this.get(c+b+d),e},toggle:function(b,c,d,e){var f=arguments.callee,g=this;a.isString(c)||a.M.isNumeric(c)?c+="":c="",a.isString(d)||a.M.isNumeric(d)?d+="":d="",a.isArray(b)?a.each(b,function(a){f.apply(g,[a,c,d,e])}):a.isUndefined(e)?this.flag(b,!this.isFlagged(b,c,d),c,d):this.flag(b,Boolean(e),c,d)}})}(_),function(a){function b(){this.type_prefix||(this.type_prefix=this.constructor.name),this.id||(this.id=a.M.nextID(this.type_prefix,!0))}a.M.BaseClass=b}(_),function(a){function b(a){var b=a.split("_");return b.length>2?b[1]:!1}function c(){this._contents={},this._usesing={}}a.M.defineConstant({CONTENT_TYPE_STRING:"string",CONTENT_TYPE_NUMBER:"number",CONTENT_TYPE_BOOLEAN:"boolean",CONTENT_TYPE_ARRAY:"array",CONTENT_TYPE_FUNCTION:"function",CONTENT_TYPE_OBJECT:"object",CONTENT_TYPE_MIXED:"mixed"}),c.prototype.hasType=function(a){return this._contents.hasOwnProperty(a)},c.prototype.types=function(){return Object.keys(this._contents)},c.prototype.contentPositions=function(b,c){var d=[],e=this;return c||(c=a.M.contentType(b)),this._contents.hasOwnProperty(c)&&Object.keys(this._contents[c]).forEach(function(a){e._contents[c][a].content===b&&d.push({type:c,key:a})}),d},c.prototype.metaPositions=function(b,c){var d=[],e=this;return c||(c=Object.keys(this._contents)),c=a.M.asArray(c),c.forEach(function(a){Object.keys(e._contents[a]).forEach(function(c){b(e._contents[a][c])&&d.push({type:a,key:c})})}),d},c.prototype.isValidKey=function(a){return!1!==b(a)},c.prototype.hasContent=function(a,b){return this.contentPositions(a,b).length>0},c.prototype.hasKey=function(a,c){return this.isUsing(a)?!0:c||(c=b(a))?this._contents.hasOwnProperty(c)&&this._contents[c].hasOwnProperty(a):!1},c.prototype.clean=function(){var b=this;Object.keys(this._contents).forEach(function(c){b._contents.hasOwnProperty(c)&&a.isEmpty(b._contents[c])&&delete b._contents[c]})},c.prototype.add=function(b,c,d){d||(d=a.M.contentType(b));var e=a.M.nextID("content_"+d+"_",!0);return this._contents.hasOwnProperty(d)||(this._contents[d]={}),this._contents[d][e]={content:b,meta:c},e},c.prototype.addUnique=function(b,c,d){d||(d=a.M.contentType(b));var e=this.contentPositions(b,d);return 0==e.length?this.add(b,c,d):e.shift().key},c.prototype.isUsing=function(a){return this._usesing.hasOwnProperty(a)},c.prototype.isUsingContent=function(a,b){var c=this.contentPositions(a,b);return c.length&&this._usesing.hasOwnProperty(c.shift().key)},c.prototype.using=function(b,c){a.isUndefined(c)||c?this._usesing[b]=!0:delete this._usesing[b]},c.prototype.unused=function(a){delete this._usesing[a]},c.prototype.remove=function(c){var d=[],e=this;return a.M.asArray(c).forEach(function(a){var c=b(a);!1!==c&&e._contents.hasOwnProperty(c)&&(delete e._contents[c][a],delete e._usesing[a],d.push({type:c,key:a}))}),this.clean(),d},c.prototype.removeContent=function(b,c){var d=this.contentPositions(b,c),e=this;return d.length&&a.each(d,function(a){delete e._contents[a.type][a.key],delete e._usesing[a.key]}),this.clean(),d},c.prototype.update=function(a,c,d){if(this.hasKey(a)){var e=b(a);return this._contents[e][a].content=c,arguments.length>=3&&(this._contents[e][a].meta=d),!0}return!1},c.prototype.updateMeta=function(a,c){if(this.hasKey(a)){var d=b(a);return this._contents[d][a].meta=c,!0}return!1},c.prototype.get=function(a){var c=b(a);return!1!==c&&this._contents[c].hasOwnProperty(a)?this._contents[c][a]:!1},c.prototype.getType=function(a){return this.hasType(a)?this._contents[a]:!1},c.prototype.getContent=function(a,b){var c=this.get(a);return!1!==c?c.content:b},c.prototype.getMeta=function(a,b){var c=this.get(a);return!1!==c?c.meta:b},c.prototype.removeUsing=function(){return this.remove(Object.keys(this._usesing))},c.prototype.removeUnusing=function(){var c=Object.keys(this._usesing),d={},e=this,f={};return c.forEach(function(a){var c=b(a);c&&(d.hasOwnProperty(c)||(d[c]=[]),d[c].push(a))}),Object.keys(this._contents).forEach(function(b){d.hasOwnProperty(b)?(f[b]=a.difference(Object.keys(e._contents[b]),d[b]),e._contents[b]=a.pick(e._contents[b],d[b])):(f[b]=d[b],delete e._contents[b])}),a.flatten(a.values(f))},c.prototype.status=function(){var a={using:Object.keys(this._usesing).length,types:{}},b=this;return Object.keys(this._contents).forEach(function(c){a.types[c]=Object.keys(b._contents[c])}),a},a.M.ContentManager=c}(_),function(a){function b(){this._content_manager=new ContentManager,this._priorities={}}a.M.defineConstant({PRIORITY_HIGHEST:100,PRIORITY_HIGH:250,PRIORITY_DEFAULT:500,PRIORITY_LOW:750,PRIORITY_LOWEST:1e3,PRIORITY_LEVEL_1:100,PRIORITY_LEVEL_2:200,PRIORITY_LEVEL_3:300,PRIORITY_LEVEL_4:400,PRIORITY_LEVEL_5:500,PRIORITY_LEVEL_6:600,PRIORITY_LEVEL_7:700,PRIORITY_LEVEL_8:800,PRIORITY_LEVEL_9:900,PRIORITY_LEVEL_10:1e3}),b.prototype.hasPriority=function(a){return this._priorities.hasOwnProperty(a)},b.prototype.hasContent=function(a){return this._content_manager.hasContent(a,"priority")},b.prototype.status=function(){var a={priorities:Object.keys(this._priorities).length,contents:0},b=this;return Object.keys(this._priorities).forEach(function(c){a.contents+=b._priorities[c].length}),a},b.prototype.addContent=function(b,c,d){a.isUndefined(c)&&(c=a.M.PRIORITY_DEFAULT);var e=this._content_manager.add(b,d,"priority");return this._content_manager.using(e),a.has(this._priorities,c)||(this._priorities[c]=[]),this._priorities[c].push(e),e},b.prototype.removeContent=function(b,c){var d=this._content_manager.contentPositions(b,"priority"),e=a.pluck(d,"key");return c?this.hasPriority(c)?this.removeKey(a.intersection(e,this._priorities[c])):!1:this.removeKey(e)},b.prototype.removeKey=function(b){var c,d=this;return c=a.pluck(this._content_manager.remove(b),"key"),a.each(Object.keys(this._priorities),function(b){d._priorities[b]=a.difference(d._priorities[b],c)}),c},b.prototype.getContents=function(b){var c=[],d=Object.keys(this._priorities),e=this,f=this._content_manager.getType("priority");return d.sort(a.M.SORT_NUMBER),a.each(d,function(d){var g=a.pick(f,e._priorities[d]);c=b?c.concat(a.pluck(a.values(g),"content")):c.concat(a.values(g))}),c},a.M.Priority=b}(_),function(a){var b={};a.M.WAITER=a.M.defineObject({has:function(c){return a.has(b,c)},add:function(c,d,e){var f=a.M.nextID("waiter_key_",!0);return b[f]={runner:c,once:a.isUndefined(d)||Boolean(d),description:e||""},f},createFunc:function(a,b,c){var d=this.add(a,b,c),e=this;return window[d]=function(){var a=[d].concat([Array.prototype.slice.call(arguments)]);e.run.apply(e,a)},d},remove:function(){var c=[],d=this;return a.each(a.flatten(a.toArray(arguments)),function(a){d.has(a)&&(c.push(a),window[a]=void 0,delete b[a],delete window[a])}),c},run:function(c,d,e){var f=!1;if(this.has(c)){var g=b[c];f=g.runner.apply(e||null,a.M.asArray(d)),g.once&&this.remove(c)}return f},list:function(c){if(c){var d={};return a.each(b,function(a,b){d[b]=a.description}),d}return Object.keys(b)}})}(_),function(a){function b(b){a.M.BaseClass.call(this),this._events={},this._event_emitted={},this._limit=(b||a.M.EVENT_EMITTER_EVENT_LIMIT_LISTENERS)+0,this._event_followers={},this._event_following={},this._event_mimics=[],this._event_privates=[]}a.M.defineConstant({EVENT_EMITTER_EVENT_LIMIT_LISTENERS:10,EVENT_EMITTER_EVENT_UNLIMITED:-1}),b.prototype.resetEvents=function(a){a?this._events.hasOwnProperty(a)&&(delete this._events[a],delete this._event_emitted[a]):(this._events={},this._event_emitted={})},b.prototype.reset=function(a){return this.resetEvents(a)},b.prototype.events=function(a){if(a){var b={},c=this;return Object.keys(this._events).forEach(function(a){b[a]=c._events[a].priority.status().contents}),b}return Object.keys(this._events)},b.prototype.emitted=function(b){return a.isUndefined(b)?a.clone(this._event_emitted):a.has(this._event_emitted,b)?parseInt(this._event_emitted[b]):0},b.prototype.limit=function(a){this._limit=a+0},b.prototype.unlimited=function(){this._limit=a.M.EVENT_EMITTER_EVENT_UNLIMITED},b.prototype.addListener=function(b,c,d){var e=this;if(a.M.isNumeric(d)&&(d={priority:d}),d=a.defaults(d||{},{priority:a.M.PRIORITY_DEFAULT,times:-1,context:null,key:null,async:!1}),c=a.M.asArray(c),this._events.hasOwnProperty(b)){if(this._limit!=a.M.EVENT_EMITTER_EVENT_UNLIMITED){var f=this._events[b].priority.status();f.contents+c.length>this._limit&&console.warn("Possible _.M.EventEmitter memory leak detected. "+(f.contents+c.length)+" listeners added (limit is "+this._limit+"). Use emitter.limit() or emitter.unlimited to resolve this warning.")}}else this._events[b]={priority:new a.M.Priority,key_mapped:{}};if(c.length){null===d.key&&(d.key=a._.M.nextID("event_emitter_listener_",!0));var g=[];return a.M.loop(c,function(c){d.context&&(c=c.bind(d.context)),-1!=d.times&&(c=a.before(d.times+1,c)),g.push(e._events[b].priority.addContent(c,d.priority,{listener_key:d.key,async:d.async}))}),a.has(this._events[b].key_mapped,d.key)?this._events[b].key_mapped[d.key]=this._events[b].key_mapped[d.key].concat(g):this._events[b].key_mapped[d.key]=g,d.key}return!1},b.prototype.on=function(a,b,c){return this.addListener.apply(this,arguments)},b.prototype.addOnceListener=function(b,c,d){return a.M.isNumeric(d)?d={priority:d,times:1}:a.isObject(d)||(d={times:1}),this.addListener(b,c,d)},b.prototype.once=function(a,b,c){return this.addOnceListener.apply(this,arguments)},b.prototype.addListeners=function(b){var c=[],d=this;a.isObject(b)&&a.each(b,function(b,d){b=a.M.asArray(b),a.each(b,function(b){b=a.M.asArray(b),c.push({name:d,cb:b[0],options:b.length>1?b[1]:{}})})}),a.each(c,function(a){d.addListener(a.name,a.cb,a.options)})},b.prototype.emitEvent=function(b,c,d){var e=this,f=!1;b=a.M.asArray(b);for(var g in b)if(b.hasOwnProperty(g)){var h=b[g];if(this._events.hasOwnProperty(h)){var i=this._events[h].priority.getContents(),j=arguments.callee;i.length&&(f=!0,a.each(i,function(b){b.meta.async?a.M.async(b.content,c,b.meta.context||e):a.M.callFunc(b.meta.context||e,b.content,c)}))}f&&(this._event_emitted.hasOwnProperty(h)?this._event_emitted[h]+=1:this._event_emitted[h]=1,d&&d.call(this),"event_emitted"!==h&&j.call(e,"event_emitted",[h,c])),"event_emitted"===h||-1!=this._event_privates.indexOf(h)||a.isEmpty(this._event_followers)||a.each(this._event_followers,function(b){function d(a,c,d){b.target.notice(a,c,d)}b.async?a.M.async(d,[e.id,h,c],e):a.M.callFunc(e,d,[e.id,h,c])})}},b.prototype.emit=function(){return this.emitEvent.apply(this,arguments)},b.prototype.removeListener=function(b,c){var d=this;b=a.M.asArray(b),a.each(b,function(b){if(a.M.isLikeString(b))a.each(Object.keys(d._events),function(c){a.has(d._events[c].key_mapped,b)&&(d._events[c].priority.removeKey(d._events[c].key_mapped[b]),delete d._events[c].key_mapped[b],0==d._events[c].priority.status().contents&&delete d._events[c])});else{if(!a.isFunction(b))throw new Error("Invalid remover, it must be key of added listener or listener it self");c=c||a.M.PRIORITY_DEFAULT,a.each(Object.keys(d._events),function(a){d._events[a].priority.removeContent(b,c),0==d._events[a].priority.status().contents&&delete d._events[a]})}})},b.prototype.off=function(){return this.removeListener.apply(this,arguments)},b.prototype.attach=function(b,c,d,e){if(a.M.isEventEmitter(b))return this._event_followers.hasOwnProperty(b.id)||(this._event_followers[b.id]={target:b,async:a.isUndefined(e)||Boolean(e)},this.emitEvent("attach",[b,c,d]),b.attachTo(this,c,d)),!0;throw new Error("Invalid _.M.EventEmitter instance")},b.prototype.attachHard=function(a,b,c){this.attach(a,b,c,!1)},b.prototype.attachTo=function(b,c,d,e){if(!a.M.isEventEmitter(b))throw new Error("Invalid _.M.EventEmitter instance");return this._event_following.hasOwnProperty(b.id)?!0:(this._event_following[b.id]={id:b.id,type:b.constructor.name,only:a.M.asArray(c||[]),excepts:a.M.asArray(d||[])},this.emitEvent("attached",[b,c,d]),e?b.attachHard(this):b.attach(this))},b.prototype.attachHardTo=function(a,b,c){return this.attachTo(a,b,c,!0)},b.prototype.notice=function(b,c,d){if(this._event_following.hasOwnProperty(b)){var e=this._event_following[b],f=this;if((a.isEmpty(e.only)||-1!==e.only.indexOf(c))&&(a.isEmpty(e.excepts)||-1===e.excepts.indexOf(c))){var g={id:e.id,type:e.type,event:c,data:d},h=[e.id+"."+c,e.type+"."+c,"noticed."+e.id+"."+c,"noticed."+e.id,"noticed."+e.type+"."+c,"noticed."+e.type,"noticed"],i=null;a.M.loop([c,e.type+".*",e.type+"."+c],function(a){return-1!=f._event_mimics.indexOf(a)?(i=a,f.emitEvent(c,d),"break"):void 0}),this.emitEvent(i?a.omit(h,i):h,[d,a.clone(g)])}}},b.prototype.detach=function(b){if(a.M.isEventEmitter(b))return this._event_followers.hasOwnProperty(b.id)&&(this.emitEvent("detach",[b]),delete this._event_followers[b.id],b.detachFrom(this)),!0;throw new Error("Invalid _.M.EventEmitter instance")},b.prototype.detachFrom=function(b){if(a.M.isEventEmitter(b))return this._event_following.hasOwnProperty(b.id)&&(this.emitEvent("detached",[b]),delete this._event_following[b.id],b.detach(this)),!0;throw new Error("Invalid _.M.EventEmitter instance")},a.M.EventEmitter=b,a.M.isEventEmitter=function(c){return a.isObject(c)?c instanceof b:!1}}(_),function(a){function b(b){if(a.has(i,b)){if(i[b].expire_time===!0||i[b].expire_time-1>a.M.nowSecond())return!0;d(b)}return!1}function c(b,c,d){!a.isUndefined(d)&&a.M.isNumeric(Number(d))||(d=a.M.CACHE_MEDIUM),i[b]={value:c,live_time:d,expire_time:d===!0?!0:a.M.nowSecond()+d}}function d(){a.each(a.flatten(arguments),function(a){delete i[a]})}function e(d,e,f){var g=a.M.CACHE_MEDIUM,h=[];if(a.isUndefined(f)&&(f=!0),b(d)){var j=i[d];if(g=j.live_time,h=j.value,a.isArray(h)||(h=[h]),f)h.push(e);else{var k=a.lastIndexOf(h,e);-1!=k&&h.splice(k,1)}}else h.push(e);return c(d,h,g),i[d].value}function f(d,e,f){if(!a.isUndefined(e)&&a.M.isNumeric(Number(e))||(e=1),a.isUndefined(f)&&(f=!0),f===!1&&(e*=-1),b(d)){var g=i[d],h=Number(g.value);a.M.isNumeric(h)||(h=0),h+=e,c(d,h,g.live_time)}else c(d,e);return i[d].value}function g(){var b=[],c=a.M.nowSecond();a.each(i,function(a,d){a.expire_time!==!0&&a.expire_time<=c&&b.push(d)}),d(b)}a.M.defineConstant({CACHE_MIN:10,CACHE_TINY:60,CACHE_SHORT:300,CACHE_MEDIUM:600,CACHE_LONG:3600,CACHE_FOREVER:!0});var h,i={},j=a.M.CACHE_SHORT;h=setInterval(g,1e3*j),a.M.CACHE=a.M.defineObject({set:function(a,b,d){c(a,b,d)},has:function(a){return b(a)},get:function(b){if(a.has(i,b)){if(i[b].expire_time===!0||i[b].expire_time>a.M.nowSecond())return i[b].value;delete i[b]}},touch:function(b,c){this.has(b)&&i[b].expire_time!==!0&&(a.M.isNumeric(c)||(c=i[b].live_time),i[b].expire_time+=c)},list:function(b){var c,d,e=a.M.nowSecond();return b?(c=[],d=function(a){c.push(a)}):(c={},d=function(a,b){c[a]=b}),a.each(i,function(a,b){(a.expire_time===!0||e<a.expire_time)&&d(b,a)}),c},clean:function(){return g()},expire:function(){d(Array.prototype.slice.apply(arguments))},cleanIntervalTime:function(b){return a.M.isNumeric(b)&&(j=a.M.minMax(parseInt(b),a.M.CACHE_MIN,a.M.CACHE_LONG),clearInterval(h),h=setInterval(g,1e3*j)),j},increment:function(b,c){return a.isUndefined(c)&&(c=1),f(b,c,!0)},decrement:function(b,c){return a.isUndefined(c)&&(c=1),f(b,c,!1)},arrayPush:function(a,b){return e(a,b,!0)},arrayWithout:function(a,b){return e(a,b,!1)}})}(_),function(a){function b(){a.M.EventEmitter.call(this),this._event_privates=["init"],this.options={},this.plugins={}}a.M.inherit(b,a.M.EventEmitter),b.prototype.option=function(b,c){this.options=a.M.setup.apply(a.M,[this.options].concat(Array.prototype.slice.apply(arguments)))},b.prototype.getOptions=function(){return a.clone(this.options)},b.prototype.onInit=function(a,b){this.once("init",a,b)},b.prototype.init=function(){this.emitEvent("init"),this.resetEvents("init")},b.prototype.addPlugin=function(b,c){return c||(c=a.M.nextID("plugin_")),this.plugins[c]=b,c},b.prototype.removePlugin=function(b){var c=this;b=a.flatten(a.toArray(arguments)),a.each(b,function(a){delete c.plugins[a]})},b.prototype.applyPlugin=function(b,c,d){var e=this;b?a.isString(b)&&(b=$(b)):b=$("body"),c||(c=Object.keys(this.plugins)),a.isObject(d)||(d={}),a.each(c,function(f){a.M.async(e.plugins[f],[b,a.has(d,f)?d[c]:{}],null)})},a.M.App=b;var c=new b;a.module("App",c)}(_),function(a){function b(b){a.M.EventEmitter.call(this),this.options={response_adapters:{},data_adapters:{},auto_abort:!0},this.jqXHR=null,this.requested=0,this.response=null,this.responses=null,this.error=null,this.last_before_send_cb=null,a.isObject(b)&&this.option(b)}function c(c){var d=b.applyResponseAdapters(c,this.options.response_adapters);return d.error?(this.error=d.error,void this.emitEvent("catch",[d.error.message,d.error.code])):(this.response=d.response,this.responses=d.responses,void this.emitEvent("then",[a.clone(d.response)]))}function d(a,c,d){var e=b.beautifyError(arguments);this.error=e,this.emitEvent("catch",[e.message,e.code])}function e(b,c){this.emitEvent("finally",[b,c]),a.App&&a.App.emitEvent("ajax_complete",[this])}function f(a,b,c){switch(b=$(b),c){case"append":b.append(a);break;case"prepend":b.prepend(a);break;default:b.html(a)}}a.M.defineConstant({AJAX_INVALID_RESPONSE_ADAPTER_OPTION:"ajax_invalid_response_adapter_option",AJAX_ERROR_RESPONSE_ADAPTER_NOT_FOUND:"ajax_response_adapter_not_found",AJAX_ERROR_INVALID_RESPONSE_ADAPTER:"ajax_invalid_response_adapter",AJAX_ABORTED:"aborted",AJAX_TIMEOUT:"timeout",AJAX_PARSER_ERROR:"parser_error",AJAX_SERVER_ERROR:500,AJAX_FORBIDDEN:403,AJAX_NOT_FOUND:404});var g={204:"Server has received the request but there is no information to send back",400:"The request had bad syntax or was inherently impossible to be satisfied",401:"The parameter to this message gives a specification of authorization schemes which are acceptable",403:"The request is for something forbidden",404:"The server has not found anything matching the URI given",405:"Method not allowed",406:"Not acceptable",408:"Request timeout",413:"Payload too large",414:"URI too long",429:"Too many requests",431:"Request header fields too large",500:"The server encountered an unexpected condition which prevented it from fulfilling the request",501:"The server does not support the facility required"},h={},i={},j={};a.M.inherit(b,a.M.EventEmitter),b.globalOption=function(b,c){j=a.M.setup.apply(a.M,[j].concat(Array.prototype.slice.apply(arguments)))},b.getGlobalOption=function(b,c){return 0==arguments.length?a.clone(j):(b+="",j.hasOwnProperty(b)?a.clone(j[b]):c)},b.beautifyError=function(b){var c=b[0],d=b[1],e=b[2],f={code:"",message:"Ajax error"};switch(d){case"parsererror":f.message="Parse response failed",f.code=a.M.AJAX_PARSER_ERROR;break;case"abort":f.message="Manual abort request",f.code=a.M.AJAX_ABORTED;break;default:f.code=c.status,g.hasOwnProperty(c.status)?f.message=g[c.status]:f.message=e}return f},b.ResponseAdapter=function(){this.type_prefix="ajax_response_adapter",a.M.BaseClass.call(this),this.handler=null,this.response=null,this.is_error=!1,this.error={code:0,message:""}},b.ResponseAdapter.prototype.process=function(b,c,d){throw a.isFunction(this.handler)||this.handler.apply(this,[b,a.isObject(c)?option:{},a.isObject(d)?a.clone(d):{},this]),new Error("AJAX response adapter handler must be function")},b.registerResponseAdapter=function(b,c){return a.isFunction(c)?(h[b]=c,!0):!1},b.responseAdapters=function(){return Object.keys(h)},b.responseAdapterFactory=function(a){if(h.hasOwnProperty(a)){var c=new b.ResponseAdapter;return c.handler=h[a],c}throw new Error("AJAX response adapter name not found")},b.applyResponseAdapters=function(c,d,e){var f,g={error:null,response:null,responses:{raw:a.clone(c)}};return a.isObject(e)||(e={}),a.M.loop(d,function(d,i){if(h.hasOwnProperty(i)){try{f=b.responseAdapterFactory(i)}catch(j){return g.error={code:null,message:j.message},"break"}return f.process(c,d,e),f.is_error?(g.error=f.error,"break"):(c=f.response,void(g.responses[i]=a.clone(f.response)))}return g.error={code:a.M.AJAX_ERROR_RESPONSE_ADAPTER_NOT_FOUND,message:"AJAX response adapter not found"},"break"}),g.error||(g.response=c),g},b.registerDataAdapter=function(b,c){return a.isFunction(c)?(i[b]=c,!0):!1},b.applyDataAdapters=function(b,c,d){return a.isObject(b)||(b={}),a.isObject(d)||(d={}),a.each(c,function(c,e){if(!i.hasOwnProperty(e))throw new Error("AJAX data adapter not found: "+e);if(!a.isFunction(i[e]))throw new Error("AJAX data adapter must be a function: "+e);b=i[e](b,a.isObject(c)?c:{},d)}),b},b.dataAdapters=function(){return Object.keys(i)},b.prototype.option=function(b,c){return this.options=a.M.setup.apply(a.M,[this.options].concat(Array.prototype.slice.apply(arguments))),this},b.prototype.then=function(a){return this.on("then",a),this},b.prototype["catch"]=function(a){return this.on("catch",a),this},b.prototype["finally"]=function(a){return this.on("finally",a),this},b.prototype.status=function(){return a.isObject(this.jqXHR)&&this.jqXHR.hasOwnProperty("readyState")?this.jqXHR.readyState:!1},b.prototype.isRequesting=function(){var a=this.status();return a!==!1&&a>=1&&3>=a},b.prototype.isReady=function(){var a=this.status();return a!==!1&&0===a},b.prototype.isDone=function(){return 4===this.status()},b.prototype.isAborted=function(){return this.error&&this.error.code===a.M.AJAX_ABORTED},b.prototype.request=function(f){var g=a.extend({},j,this.options,f);return g.hasOwnProperty("beforeSend")&&(this.last_before_send_cb=g.beforeSend),g.hasOwnProperty("success")&&(this.removeListener("listener_success"),this.addListener("then",g.success,{priority:a.M.PRIORITY_HIGHEST,key:"listener_success"})),g.hasOwnProperty("error")&&(this.removeListener("listener_error"),this.addListener("catch",g.error,{priority:a.M.PRIORITY_HIGHEST,key:"listener_error"})),g.hasOwnProperty("complete")&&(this.removeListener("listener_complete"),this.addListener("finally",g.complete,{priority:a.M.PRIORITY_HIGHEST,key:"listener_complete"})),g.success=c.bind(this),g.error=d.bind(this),g.complete=e.bind(this),g.beforeSend=function(b,c){var d=!0;return a.isFunction(this.last_before_send_cb)&&(d=a.M.callFunc(this,this.last_before_send_cb,[b,c])),this.option("auto_abort")&&this.abort(),!1!==d&&(this.requested++,this.error=null,this.response=null,this.responses=null,this.emitEvent("request")),d}.bind(this),a.isObject(g.data)||(g.data={}),g.data_adapters&&(g.data=b.applyDataAdapters(a.clone(g.data),g.data_adapters)),this.jqXHR=$.ajax(g),this.jqXHR},b.prototype.abort=function(){this.isRequesting()&&this.jqXHR.abort&&(this.emitEvent("abort"),this.jqXHR.abort())},b.load=function(c,d,e){var g=new b;a.isObject(e)||(e={}),e=a.extend({error_content:null,apply_type:"replace"},e,{url:c}),g.option(e),g.then(function(a){f(a,d,e.apply_type)})["catch"](function(b,c){var g="";g=a.isNull(e.error_content)?["Load content failed: ",b,". Error code: ",c].join(""):a.isFunction(e.error_content)?e.error_content(b,c):e.error_content+"",f(g,d,e.apply_type)})},a.M.AJAX=b}(_);
//# sourceMappingURL=madnh.min.js.map