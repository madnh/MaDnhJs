!function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(c){return a.M=b(c)}):a.M=b(a._)}(this,function(a){function b(b,c,d){return d||a.isUndefined(d)?b+"_"+c:c}function c(a,b){return a!==b}function d(a,b){return a!=b}function e(b,e,f){if(arguments.length<2)return{};var g={};return a.isFunction(b)||(b=b?c:d),f=j.mergeObject.apply(j,k.call(arguments,2)),a.each(e,function(a,c){f.hasOwnProperty(c)?b(a,f[c])&&(g[c]=a):g[c]=a}),g}function f(a,b){return function(b){console[a].apply(console,(b?[b]:[]).concat(k.apply(arguments)))}(b)}function g(a,b){return a-b}function h(a,b){return b-a}var i="1.2.8",j={};Object.defineProperty(j,"VERSION",{value:i});var k=Array.prototype.slice;j.sliceArguments=function(a,b,c){return k.apply(a,k.call(arguments,1))},j.beNumber=function(b,c){return b=parseFloat(b),j.isNumeric(b)?b:a.isUndefined(c)?0:j.isNumeric(c)?parseFloat(c):j.beNumber(c,0)},j.beObject=function(b,c){switch(!0){case 1==arguments.length:return a.isObject(b)?b:a.isArray(b)||a.isArguments(b)?a.zipObject(Object.keys(b),b):{0:b};case arguments.length>=2:if(a.isObject(b))return b;var d={};return d[b]=c,d}return{}};var l={};l.string=function(a){return a+""},l["boolean"]=function(a){return Boolean(a)},l.number=function(a){return j.beNumber(a)},l.integer=function(a){return Math.floor(j.beNumber(a))},l.array=a.castArray,l.object=function(a){return j.beObject(a)},j.castItemsType=function(b,c){if(!l.hasOwnProperty(c))throw new Error("Invalid cast type. Available types are: string, number, integer, array and object");return a.isArray(b)?a.map(a.clone(b),l[c]):a.mapObject(a.clone(b),l[c])},j.loop=function(b,c,d){var e,f;if(a.isUndefined(d)&&(d="break"),a.isArray(b))for(e=0,f=b.length;f>e&&c(b[e],e,b)!==d;e++);else{var g=a.keys(b);for(e=0,f=g.length;f>e&&c(b[g[e]],g[e],b)!==d;e++);}return b};var m={};j.nextID=function(c,d){return a.isEmpty(c)&&(c="unique_id"),m.hasOwnProperty(c)?m[c]++:m[c]=1,b(c,m[c],d)},j.currentID=function(c,d){return a.isEmpty(c)&&(c="unique_id"),m.hasOwnProperty(c)?b(c,m[c],d):!1},j.resetID=function(b,c){return arguments.length||(b="unique_id"),b=String(b),a.isUndefined(c)?delete m[b]:(c=arguments.length>1?j.beNumber(c):0,c=Math.max(c,0),m[b]=c),c},j.className=function(a,b){return b?a.constructor.name:Object.prototype.toString.call(a)},j.contentType=function(a){var b=typeof a;if("object"===b){var c=j.className(a,!0);if(c)return c}return b},j.isInstanceOf=function(a,b){return j.className(a,!0)===b},j.isPrimitiveType=function(b){if(a.isObject(b))return!1;var c=typeof b;return null==b||"string"===c||"number"===c||"boolean"===c},j.mergeObject=function(){for(var b=0,c=0,d=arguments.length;d>c;c++)!a.isArray(arguments[c])&&a.isObject(arguments[c])||(arguments[c]=a.castArray(arguments[c]),arguments[c]=a.zipObject(a.range(b,b+=arguments[c].length),arguments[c]));return a.extend.apply(a,arguments)},j.diffObject=function(b,d){var f=a.flatten(a.toArray(arguments));return f.unshift(c),e.apply(null,f)},j.diffObjectLoose=function(b,c){var f=a.flatten(a.toArray(arguments));return f.unshift(d),e.apply(null,f)},j.diffObjectWith=function(a,b,c){return e.apply(null,k.apply(arguments))},j.randomString=function(b,c){var d,e,f="";for(!a.isUndefined(c)&&c.toString().length||(c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),d=c.length,b=j.beNumber(b,10),e=b;e>0;--e)f+=c[Math.round(Math.random()*(d-1))];return f},j.setup=function(b,c,d){return a.isObject(b)||(b={}),a.isObject(c)?a.each(c,function(c,d){a.set(b,d,c)}):a.set(b,c,d),b},j.validKeys=function(b,c){var d=[];c=a.castArray(c);for(var e=0,f=c.length;f>e;e++)b.hasOwnProperty(c[e])&&d.push(c[e]);return d},j.pairsAsObject=function(b,c,d){var e=[],f=c||"key",g=d||"value";return a.each(b,function(a,b){var c={};c[f]=b,c[g]=a,e.push(c)}),e},j.pluckBy=function(b,c,d){var e={};return a.each(b,function(a){a.hasOwnProperty(c)&&(e[a[c]]=a.hasOwnProperty(d)?a[d]:void 0)}),e},j.isNumeric=function(b){return!a.isArray(b)&&b-parseFloat(b)+1>=0},j.oneOf=function(b,c,d){return-1!==c.indexOf(b)?b:arguments.length>=3?d:a.first(c)},j.escapeURL=function(a,b){return b?encodeURIComponent(a):encodeURI(a)},j.unescapeURL=function(a,b){return b?decodeURI(a):decodeURIComponent(a)},j.chunks=function(b,c){return a.chunk(b,Math.ceil(b.length/c))},j.toggle=function(b,c,d){if(c=a.uniq(a.castArray(c)),a.isUndefined(d)){var e=a.intersection(b,c),f=a.difference(c,b);b=a.union(a.difference(b,e),f)}else b=d?a.union(b,c):a.difference(b,c);return b},j.defineObject=function(b){var c={};return a.each(b,function(b,d){d=d.trim(),a.has(c,d)||Object.defineProperty(c,d,{enumerable:!a.isFunction(b),value:b})}),c},j.defineConstant=function(b,c,d){var e={};a.isObject(c)?(e=c,d=void 0):e[c]=d,a.each(e,function(a,c){c=c.trim().toUpperCase(),b.hasOwnProperty(c)||Object.defineProperty(b,c,{enumerable:!0,value:a})})},j.inherit=function(b,c,d){var e=b.prototype=Object.create(c.prototype);e.constructor=b,(d||a.isUndefined(d))&&(e._super=c.prototype)},j.callFunc=function(b,c,d){if(c=arguments.length>=2?a.castArray(c):[],b){if(a.isFunction(b))return b.apply(d||null,c);if(a.isString(b)){if(window.hasOwnProperty(b)&&a.isFunction(window[b]))return window[b].apply(d||null,c);throw new Error("Invalid callback!")}if(a.isArray(b)){var e=[],f=arguments.callee;return a.each(b,function(a){e.push(f(a,c,d))}),e}}},j.async=function(b,c,d,e){return d=parseInt(d),a.isNaN(d)&&(d=1),setTimeout(function(){j.callFunc(b,c,e||null)},Math.max(1,d))},j.logArgs=function(){console.log.apply(console,k.apply(arguments))},j.logCb=function(a){return f.apply(null,["log"].concat(k.apply(arguments)))},j.warnArgs=function(){console.warn.apply(console,k.apply(arguments))},j.warnCb=function(a){return f.apply(null,["warn"].concat(k.apply(arguments)))},j.errorArgs=function(){console.error.apply(console,k.apply(arguments))},j.errorCb=function(a){return f.apply(null,["error"].concat(k.apply(arguments)))};var n={},o=!1;return j.isDebugging=function(b){return o||a.isEmpty(b)?o:n.hasOwnProperty(b)&&n[b]},j.debugging=function(b){return a.isEmpty(b)?void(o=!0):void(n[b]=!0)},j.debugComplete=function(b){return a.isEmpty(b)?(o=!1,void(n={})):void delete n[b]},j.onDebugging=function(a,b){j.isDebugging(a)&&j.callFunc(b)},j.getDebugString=function(b,c){var d=[];return a.each(a.castArray(b),function(a){d.push(JSON.stringify(a))}),d.join(c||"\n")},j.optionalArgs=function(b,c,d){var e,f,g,h,i,k,l,m={},n=0;if(g=a.difference(c,Object.keys(d)),g.forEach(function(a){d[a]=!0}),k=c.map(function(a){return d[a]}),a.isEmpty(b))return m;if(b.length>=c.length)m=a.zipObject(c,b.slice(0,c.length));else for(i=b.slice(0);e=i.shift();){if(h=j.contentType(e),l=!1,f=n,j.loop(k.slice(n),function(b,c){return function(d){return d===!0||c===d||a.isArray(d)&&-1!=d.indexOf(c)||a.isFunction(d)&&d(b)?(l=!0,"break"):void n++}}(e,h)),!l){m=a.zipObject(c.slice(0,b.length),b);break}m[c[n++]]=e}return m},j.defineConstant(j,{SORT_NUMBER:g,SORT_NUMBER_DESC:h}),j}),function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Flag=b()}):a.Flag=b()}(this,function(){function a(){this._flags={}}a.prototype.hasFlag=function(a){return this._flags&&this._flags.hasOwnProperty(a)},a.prototype.flag=function(a,b){if(b=b||"undefined"==typeof b?!0:Boolean(b),this._flags||(this._flags={}),a instanceof Array)for(var c=0,d=a.length;d>c;c++)this._flags[a[c]]=b;else if(a instanceof Object)for(var e in a)a.hasOwnProperty(e)&&(this._flags[e]=Boolean(a[e]));else this._flags[a]=b;return this},a.prototype.flagStatus=function(a){return this._flags&&this._flags.hasOwnProperty(a)&&Boolean(this._flags[a])},a.prototype.isFlagged=function(a){return!0===this.flagStatus(a)},a.prototype.toggleFlag=function(a,b){if(a instanceof Array){for(var c in a)this.toggleFlag(a[c],b);return this}return"undefined"!=typeof b?this.flag(a,Boolean(b)):this.flag(a,!this.isFlagged(a)),this},a.prototype.resetFlagStatus=function(){return this._flags={},this},a.mixin=function(b){for(var c=["hasFlag","flag","flagStatus","isFlagged","toggleFlag","resetFlagStatus"],d=0;d<c.length;d++)"function"==typeof b?b.prototype[c[d]]=a.prototype[c[d]]:b[c[d]]=a.prototype[c[d]];return b};for(var b=new a,c=["hasFlag","flag","flagStatus","isFlagged","toggleFlag","resetFlagStatus"],d=0,e=c.length;e>d;d++)a[c[d]]=function(a){return function(){return b[a].apply(b,Array.prototype.slice.call(arguments))}}(c[d]);return a}),function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(a){return b(a)}):a.PreOptions=b(a._)}(this,function(a){function b(){}function c(b,c,e,f,g){if(d.hasOwnProperty(e))throw new Error("Destination Pre Options is already exists");c=a.castArray(c);var h=a.filter(c,function(a){return!d.hasOwnProperty(a)});if(!a.isEmpty(h))throw new Error("PreOptions are not defined:"+h.join(", "));if(a.isObject(f)||(f={}),g)d[e]={options:f,base:c};else{var i={};a.each(c,function(c){a.extend(i,b.get(c))}),a.extend(f,i),d[e]={options:f,base:[]}}}var d={};return b.prototype.define=function(a,b,c){return c||!d.hasOwnProperty(a)?(d[a]={options:b,base:[]},!0):!1},b.prototype.has=function(a){return d.hasOwnProperty(a)},b.prototype.update=function(b,c){return d.hasOwnProperty(b)?(a.extend(d[b].options,c),!0):!1},b.prototype.updateBase=function(a,b){return d.hasOwnProperty(a)?(d[a].base=b,!0):!1},b.prototype.get=function(b,c){if(!d.hasOwnProperty(b))throw new Error('Pre Options "'+b+'" is undefined');var e=this,f={};return a.each(a.castArray(d[b].base),function(b){a.extend(f,e.get(b))}),a.extend(f,a.cloneDeep(d[b].options),a.isObject(c)?c:{}),f},b.prototype.extend=function(a,b,d){c(this,a,b,d,!0)},b.prototype.baseOn=function(a,b,d){c(this,a,b,d,!1)},b.prototype.list=function(b){return b?a.cloneDeep(d):a.keys(d)},b.prototype.reset=function(){d={}},new b}),function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(c){return a.ContentManager=b(c)}):a.ContentManager=b(a._)}(this,function(a){function b(){this.id=a.uniqueId("ContentManager_"),this._contents={},this._usings={}}function c(a,b){var c=b.substr(a.id.length+1).split("_");return c.length>1?c[0]:!1}function d(a,b){return b?a.constructor.name:Object.prototype.toString.call(a)}function e(a){var b=typeof a;if("object"===b){var c=d(a,!0);if(c)return c}return b}var f;f={CONTENT_TYPE_STRING:"string",CONTENT_TYPE_NUMBER:"number",CONTENT_TYPE_BOOLEAN:"boolean",CONTENT_TYPE_ARRAY:"array",CONTENT_TYPE_FUNCTION:"function",CONTENT_TYPE_OBJECT:"object",CONTENT_TYPE_MIXED:"mixed"};for(var g in f)f.hasOwnProperty(g)&&Object.defineProperty(b,g,{enumerable:!0,value:f[g]});return b.prototype.hasType=function(a){return this._contents.hasOwnProperty(a)},b.prototype.types=function(){return Object.keys(this._contents)},b.prototype.keys=function(){var a=this,b={};return Object.keys(this._contents).forEach(function(c){b[c]=Object.keys(a._contents[c])}),b},b.prototype.filter=function(b,c){var d=[],e=this;return c=a.isUndefined(c)?Object.keys(this._contents):a.intersection(a.castArray(c),Object.keys(this._contents)),a.each(c,function(c){a.each(Object.keys(e._contents[c]),function(a){b(e._contents[c][a].content,e._contents[c][a].meta,a,c)&&d.push({type:c,key:a,content:e._contents[c][a].content,meta:e._contents[c][a].meta})})}),d},b.prototype.find=function(b,c){var d,e,f,g,h=!1,i=this;for(c=a.isUndefined(c)?Object.keys(this._contents):a.intersection(a.castArray(c),Object.keys(this._contents));!h&&(d=c.shift());)for(f=Object.keys(i._contents[d]);!h&&(e=f.shift());)g=i._contents[d][e],b(g.content,g.meta,e,d)&&(h={type:d,key:e,content:g.content,meta:g.meta});return h},b.prototype.contentPositions=function(a,b){var c=function(b){return a===b};return this.filter(c,b)},b.prototype.isValidKey=function(a){return!1!==c(this,a)},b.prototype.hasContent=function(a,b){var c=function(b){return a===b};return!1!==this.find(c,b)},b.prototype.has=function(a){if(this.isUsing(a))return!0;var b=c(this,a);return!1!==b?this._contents.hasOwnProperty(b)&&this._contents[b].hasOwnProperty(a):!1},b.prototype.clean=function(){var b=this;a.each(Object.keys(this._contents),function(c){a.isEmpty(b._contents[c])&&delete b._contents[c]})},b.prototype.add=function(b,c,d){d||(d=e(b));var f=a.uniqueId(this.id+"_"+d+"_");return this._contents.hasOwnProperty(d)||(this._contents[d]={}),this._contents[d][f]={content:b,meta:c},f},b.prototype.addUnique=function(a,b,c){c||(c=e(a));var d=this.contentPositions(a,c);return 0==d.length?this.add(a,b,c):d.shift().key},b.prototype.items=function(b,d){var e,f,g,h={};if(g=d?function(a){return a}:function(a){return a.content},a.isEmpty(b)){for(e in this._contents)if(this._contents.hasOwnProperty(e))for(f in this._contents[e])this._contents[e].hasOwnProperty(f)&&(h[f]=g(this._contents[e][f]))}else{var i=a.groupBy(a.castArray(b),a.partial(c,this));for(e in i)i.hasOwnProperty(e)&&a.each(a.pick(this._contents[e],i[e]),function(a,b){h[b]=g(a)})}return h},b.prototype.isUsing=function(a){return this._usings.hasOwnProperty(a)},b.prototype.isUsingContent=function(b,c){var d=this.contentPositions(b,c);return a.isEmpty(d)?!1:!a.isEmpty(a.intersection(a.map(d,"key"),Object.keys(this._usings)))},b.prototype.using=function(b,c){return this.has(b)?(a.isUndefined(c)||c?this._usings[b]=!0:delete this._usings[b],!0):!1},b.prototype.unused=function(b){this._usings=a.omit(this._usings,a.flatten(a.toArray(arguments)))},b.prototype.usingKeys=function(b){return b?a.groupBy(Object.keys(this._usings),a.partial(c,this)):Object.keys(this._usings)},b.prototype.unusedKeys=function(b){var c=this.usingKeys(!0),d={};for(var e in this._contents)this._contents.hasOwnProperty(e)&&(c.hasOwnProperty(e)?d[e]=a.difference(Object.keys(this._contents[e]),c[e]):d[e]=Object.keys(this._contents[e]),a.isEmpty(d[e])&&delete d[e]);return b?d:a.flatten(a.values(d))},b.prototype.get=function(a){var b=c(this,a);return!1!==b&&this._contents[b].hasOwnProperty(a)?this._contents[b][a]:!1},b.prototype.getType=function(a){return this.hasType(a)?this._contents[a]:!1},b.prototype.getContent=function(a,b){var c=this.get(a);return!1!==c?c.content:b},b.prototype.getMeta=function(a,b){var c=this.get(a);return!1!==c?c.meta:b},b.prototype.remove=function(b){var d=[],e=a.groupBy(a.flatten(a.toArray(arguments)),a.partial(c,this));delete e["false"];for(var f in e)if(e.hasOwnProperty(f)&&this._contents.hasOwnProperty(f))for(var g in e[f])e[f].hasOwnProperty(g)&&(d.push({type:f,key:e[f][g]}),delete this._contents[f][e[f][g]],delete this._usings[e[f][g]]);return this.clean(),d},b.prototype.removeContent=function(b,c){var d=this.contentPositions(b,c),e=this;return d.length&&a.each(d,function(a){delete e._contents[a.type][a.key],delete e._usings[a.key]}),this.clean(),d},b.prototype.update=function(a,b,d){if(this.has(a)){var e=c(this,a);return this._contents[e][a].content=b,arguments.length>=3&&(this._contents[e][a].meta=d),!0}return!1},b.prototype.updateMeta=function(a,b){if(this.has(a)){var d=c(this,a);return this._contents[d][a].meta=b,!0}return!1},b.prototype.removeUsing=function(){return this.remove(Object.keys(this._usings))},b.prototype.removeNotUsing=function(){return this.remove(this.unusedKeys())},b.prototype.status=function(){return{using:Object.keys(this._usings),types:this.keys()}},b}),function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Priority=b()}):a.Priority=b()}(this,function(){function a(){this._priorities={},this._key_mapped={}}function b(a,b,c){for(var d,e,f,g,h=[],i=Object.keys(a._priorities);d=i.shift();)for(g=a._priorities[d],e=0,f=g.length;f>e;e++)if(g[e]&&b(g[e].content,g[e].priority_key)){if(!c)return g[e].priority_key;h.push(g[e].priority_key)}return h.length?h:!1}function c(a){return"[object Array]"===h.call(a)}function d(a){return c(a)?a:[a]}var e,f,g=0;f={PRIORITY_HIGHEST:100,PRIORITY_HIGH:250,PRIORITY_DEFAULT:500,PRIORITY_LOW:750,PRIORITY_LOWEST:1e3,PRIORITY_LEVEL_1:100,PRIORITY_LEVEL_2:200,PRIORITY_LEVEL_3:300,PRIORITY_LEVEL_4:400,PRIORITY_LEVEL_5:500,PRIORITY_LEVEL_6:600,PRIORITY_LEVEL_7:700,PRIORITY_LEVEL_8:800,PRIORITY_LEVEL_9:900,PRIORITY_LEVEL_10:1e3};for(e in f)Object.defineProperty(a,e,{enumerable:!0,value:f[e]});a.prototype.hasPriority=function(a){return this._priorities.hasOwnProperty(a+"")},a.prototype.has=function(a){return this._key_mapped.hasOwnProperty(a)},a.prototype.add=function(b,c){var d,e="priority_key_"+ ++g;return"number"==typeof c&&c===c||(c=a.PRIORITY_DEFAULT),this.hasPriority(c)||(this._priorities[c]=[]),d=this._priorities[c].length,this._priorities[c].push({content:b,priority_key:e}),this._key_mapped[e]={priority:c,index:d},e},a.prototype.findAll=function(a){return b(this,function(b){return a===b},!0)},a.prototype.findAllBy=function(a){return b(this,a,!0)},a.prototype.find=function(a){return b(this,function(b){return a===b},!1)},a.prototype.findBy=function(a){return b(this,a,!1)},a.prototype.hasContent=function(a){return!1!==this.find(a)},a.prototype.hasContentBy=function(a){return!1!==this.findBy(a)},a.prototype.addOnce=function(a,b){var c=this.find(a);return!1!==c?c:this.add(a,b)},a.prototype.get=function(a){if(!this.has(a))return!1;var b=this._key_mapped[a];return this._priorities[b.priority][b.index]},a.prototype.update=function(a,b){var c;return this.has(a)?(c=this._key_mapped[a],this._priorities[c.priority][c.index]=b,!0):!1},a.prototype.remove=function(a){var b,c,e,f=[];a=d(a);for(b in a)if(a.hasOwnProperty(b)){if(c=a[b],e=this._key_mapped[c],!e)continue;delete this._key_mapped[c],this._priorities[e.priority][e.index]=void 0,f.push(c)}return f},a.prototype.removeBy=function(a){var b=this.findAllBy(a);return!1===b?[]:this.remove(b)},a.prototype.removeByContent=function(a){return this.removeBy(function(b){return a===b})},a.prototype["export"]=function(a){var b,c,d=[],e=Object.keys(this._priorities);for(e.sort(function(a,b){return a-b});b=e.shift();)for(c in this._priorities[b])this._priorities[b].hasOwnProperty(c)&&(a?d.push(this._priorities[b][c].content):d.push({content:this._priorities[b][c].content,priority_key:this._priorities[b][c].priority_key}));return d};var h=Object.prototype.toString;return a}),function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Waiter=b()}):a.Waiter=b()}(this,function(){function a(){}function b(a){return"[object Array]"===h.call(a)}function c(a){return b(a)?a:[a]}function d(a){var c=[];if(!a.length)return[];for(var e in a)a.hasOwnProperty(e)&&(b(a[e])?c=c.concat(d(a[e])):c.push(a[e]));return c}var e={},f=0,g=Array.prototype.slice;a.prototype.has=function(a){return e.hasOwnProperty(a)&&("number"!=typeof e[a].times||e[a].times>0)},a.prototype.add=function(a,b,c){var d="waiter_key_"+ ++f;return"number"==typeof b?(b=parseInt(b),b=b!==b?1:Math.max(b,1)):b=!0,e[d]={callback:a,times:b,description:c},d},a.prototype.addOnce=function(a,b){return this.add(a,1,b)},a.prototype.createFunc=function(a,b,c){var d=this.add(a,b,c),e=this;return window[d]=function(a){return function(){return e.run.apply(e,[a].concat(g.call(arguments)))}}(d),d},a.prototype.createFuncOnce=function(a,b){return this.createFunc(a,1,b)},a.prototype.remove=function(){var a,b,c=d(g.call(arguments)),f=[];for(b in c)c.hasOwnProperty(b)&&e.hasOwnProperty(c[b])&&(a=c[b],f.push(a),window[a]=void 0,delete e[a],delete window[a]);return f},a.prototype.run=function(a,b,d){var f;if(!this.has(a))throw new Error("Waiter key is non-exists: "+a);return f=e[a].callback.apply(d||null,c(b)),this.has(a)&&"number"==typeof e[a].times&&--e[a].times<1&&this.remove(a),f},a.prototype.list=function(a){var b={};if(a){for(var c in e)e.hasOwnProperty(c)&&(b[c]=e[c].description);return b}return Object.keys(e)};var h=Object.prototype.toString;return new a}),function(a,b){"function"==typeof define&&define.amd?define(["lodash","Priority"],function(c,d){return a.EventEmitter=b(c,d)}):a.EventEmitter=b(a._,a.Priority)}(this,function(a,b){function c(b){this.id=a.uniqueId("event_emitter_"),b=a.defaults(b||{},{events:{},event_mimics:[],event_privates:[]}),this._events={},this._event_emitted={},this._event_followers={},this._event_following={},this._event_mimics=[],this._event_privates=["attach","attached"],a.isObject(b.events)||this.addListeners(b.events),a.isEmpty(b.event_mimics)||this.mimic(a.castArray(b.event_mimics)),a.isEmpty(b.event_privates)||this["private"](a.castArray(b.event_privates))}function d(c,d){a.each(d,function(a){c._events.hasOwnProperty(a)||(c._events[a]={priority:new b,key_mapped:{}})})}function e(c){return a.isNumber(c)&&(c={priority:c}),c=a.defaults(c||{},{priority:b.PRIORITY_DEFAULT,times:!0,context:null,key:"",async:!1}),null===c.key&&(c.key=a.uniqueId("event_emitter_listener_")),c}function f(b,c,d,e){var f=[],g=b._events[c];return a.each(a.castArray(d),function(a){var b=g.priority.add({listener:a,listener_key:e.key,async:e.async,times:e.times,event:c},e.priority);f.push(b)}),f}function g(b,c){return c?a.intersection(a.castArray(c),a.keys(b._events)):a.keys(b._events)}function h(b,c,d){var e,f=!1;return b._events.hasOwnProperty(c)&&(e=b._events[c].priority["export"](!0),e.length&&(f=!0,a.each(e,function(a){if(a.times===!0||a.times>0){if((a.async?n:m)(a.listener,d,a.context||b),a.times===!0)return;if(a.times--,a.times>0)return void b._events[c].priority.update(a.priority_key,a)}i(b,c,a.listener_key,a.priority_key)}))),b._event_emitted.hasOwnProperty(c)?b._event_emitted[c]+=1:b._event_emitted[c]=1,f}function i(b,c,d,e){b._events.hasOwnProperty(c)&&b._events[c].key_mapped.hasOwnProperty(d)&&(b._events[c].priority.remove(e),b._events[c].key_mapped[d]=a.without(b._events[c].key_mapped[d],e),b._events[c].key_mapped[d].length||delete b._events[c].key_mapped[d])}function j(b,c){return"event_emitted"!==c&&-1==b._event_privates.indexOf(c)&&!a.isEmpty(b._event_followers)}function k(b,c,d){a.each(b._event_followers,function(e){(e.async?n:m)(a.partial(l,e),[b.id,c,d],b)})}function l(a,b,c,d){a.target.notice(b,c,d)}function m(b,c,d){if(c=arguments.length>=2?a.castArray(c):[],b){if(a.isArray(b)){var e=[];return a.each(b,function(a){e.push(a.apply(d||null,c))}),e}if(a.isFunction(b))return b.apply(d||null,c)}}function n(b,c,d,e){return d=parseInt(d),!a.isNaN(d)&&a.isFinite(d)||(d=1),setTimeout(function(){m(b,c,e||null)},Math.max(1,d))}function o(b,c,d){for(var e,f,g={},h=a.clone(d);c.length&&(e=h.shift());)f=a.intersection(c,a.keys(b._events[e].key_mapped)),f.length&&(g[e]=f,c=a.difference(c,f));return g}function p(b,c,d){var e,f=o(b,c,d);return a.each(f,function(c,d){e=b._events[d],e.priority.remove(a.flatten(a.values(a.pick(e.key_mapped,c)))),e.key_mapped=a.omit(e.key_mapped,c),b._events[d]=e}),f}function q(a,b){return a===b.listener}function r(b,c,d){var e,f={};return a.each(c,function(c){var g=a.partial(q,c);a.each(d,function(a){var c=b._events[a].priority.findAllBy(g);if(0!=c&&(e=b._events[a].priority.remove(c),e.length)){var d=s(b._events[a].key_mapped,e),h={};h[a]=Object.keys(d),t(f,h)}})}),f}function s(b,c){for(var d,e,f=Object.keys(b),g={};c.length&&(e=f.shift());)d=a.intersection(c,b[e]),d.length&&(b[e]=a.difference(b[e],d),b[e].length||delete b[e],c=a.difference(c,d),g[e]=d);return g}function t(b,c){a.each(c,function(c,d){c=a.castArray(c),b.hasOwnProperty(d)?b[d]=a.concat(b[d],c):b[d]=c})}return c.prototype.resetEvents=function(a){a?this._events.hasOwnProperty(a)&&(delete this._events[a],delete this._event_emitted[a]):(this._events={},this._event_emitted={})},c.prototype.reset=function(a){return this.resetEvents(a)},c.prototype.events=function(a){if(a){var b={},c=this;return Object.keys(this._events).forEach(function(a){b[a]=c._events[a].priority.status().contents}),b}return Object.keys(this._events)},c.prototype.emitted=function(b){return a.isUndefined(b)?a.clone(this._event_emitted):this._event_emitted.hasOwnProperty(b)?this._event_emitted[b]:0},c.prototype.addListener=function(b,c,g){var h=this;return c=a.castArray(c),b=a.uniq(a.castArray(b)),c.length?(d(this,b),g=e(g),a.each(b,function(b){var d=h._events[b],e=f(h,b,c,g);d.key_mapped.hasOwnProperty(g.key)?d.key_mapped[g.key]=a.concat(d.key_mapped[g.key],e):d.key_mapped[g.key]=e}),g.key):!1},c.prototype.has=function(b,c){if(c=g(this,c),a.isEmpty(c))return!1;var d,e=!1,f=this;for(d in c)if(c.hasOwnProperty(d)&&f._events[c[d]].key_mapped.hasOwnProperty(b)){e=!0;break}return e},c.prototype.on=function(b,c,d){return this.addListener.apply(this,a.toArray(arguments))},c.prototype.addOnceListener=function(b,c,d){return a.isNumber(d)?d={priority:d,times:1}:a.isObject(d)||(d={times:1}),this.addListener(b,c,d)},c.prototype.once=function(b,c,d){return this.addOnceListener.apply(this,a.toArray(arguments))},c.prototype.addListeners=function(b){var c=[],d=this,e=[];return a.isObject(b)&&a.each(b,function(b,d){b=a.castArray(b),a.each(b,function(b){b=a.castArray(b),c.push({name:d,cb:b[0],options:b.length>1?b[1]:{}})})}),a.each(c,function(a){e.push(d.addListener(a.name,a.cb,a.options))}),e},c.prototype.emitEvent=function(b,c,d){var e=this;a.each(a.castArray(b),function(b){e._events.hasOwnProperty(b)&&h(e,b,a.clone(c)),"event_emitted"!==b&&h(e,"event_emitted",[b,a.clone(c)]),j(e,b)&&k(e,b,a.clone(c)),h(e,b+"_complete",a.clone(c))}),d&&d.call(this)},c.prototype.emit=function(){this.emitEvent.apply(this,a.toArray(arguments))},c.prototype.removeListener=function(b,c,d){var e,f,h=this,i={};return b=a.castArray(b),c=g(h,c),e=a.filter(b,a.isString),f=a.filter(b,a.isFunction),e.length&&(i=p(h,e,c,d)),f.length&&t(i,r(h,f,c,d)),a.each(c,function(b){a.isEmpty(h._events[b].key_mapped)&&delete h._events[b]}),i},c.prototype.off=function(){return this.removeListener.apply(this,a.toArray(arguments))},c.prototype["private"]=function(){this._event_mimics=a.concat(this._event_privates,a.flatten(a.toArray(arguments)))},c.prototype.mimic=function(){this._event_mimics=a.concat(this._event_mimics,a.flatten(a.toArray(arguments)))},c.prototype.attach=function(b,d,e,f){if(!c.isEventEmitter(b))throw new Error("Invalid EventEmitter instance");return this._event_followers.hasOwnProperty(b.id)?!1:(this._event_followers[b.id]={target:b,async:a.isUndefined(f)||Boolean(f)},this.emitEvent("attach",[b,d,e]),b.attachTo(this,d,e),!0)},c.prototype.hasFollower=function(a){return c.isEventEmitter(a)&&this._event_followers.hasOwnProperty(a.id)},c.prototype.attachHard=function(a,b,c){return this.attach(a,b,c,!1)},c.prototype.attachTo=function(b,d,e,f){if(!c.isEventEmitter(b))throw new Error("Invalid EventEmitter instance");return this._event_following.hasOwnProperty(b.id)?!0:(this._event_following[b.id]={id:b.id,type:b.constructor.name,only:a.castArray(d||[]),excepts:a.castArray(e||[])},this.emitEvent("attached",[b,d,e]),f?b.attachHard(this):b.attach(this))},c.prototype.isFollowing=function(a){return c.isEventEmitter(a)&&this._event_following.hasOwnProperty(a.id)},c.prototype.attachHardTo=function(a,b,c){return this.attachTo(a,b,c,!0)},c.prototype.notice=function(b,c,d){if(this._event_following.hasOwnProperty(b)){var e=this._event_following[b],f=this;if((a.isEmpty(e.only)||-1!==e.only.indexOf(c))&&(a.isEmpty(e.excepts)||-1===e.excepts.indexOf(c))){var g=[c,e.type+".*",e.type+"."+c];if(!a.isEmpty(a.intersection(g,f._event_mimics)))return void f.emitEvent(c,d);var h={id:e.id,type:e.type,event:c,data:d},i=[e.id+"."+c,e.type+"."+c,"noticed."+e.id+"."+c,"noticed."+e.id,"noticed."+e.type+"."+c,"noticed."+e.type,"noticed"];this.emitEvent(i,h)}}},c.prototype.detach=function(a){if(!c.isEventEmitter(a))throw new Error("Invalid EventEmitter instance");return this._event_followers.hasOwnProperty(a.id)?(this.emitEvent("detach",[a]),delete this._event_followers[a.id],a.detachFrom(this),!0):!1},c.prototype.detachFrom=function(a){if(!c.isEventEmitter(a))throw new Error("Invalid EventEmitter instance");return this._event_following.hasOwnProperty(a.id)?(this.emitEvent("detached",[a]),delete this._event_following[a.id],a.detach(this),!0):!1},c.isEventEmitter=function(a){return a instanceof c},c}),function(a,b){"function"==typeof define&&define.amd?define(["lodash"],function(c){return a.Cache=b(c)}):a.Cache=b(a._)}(this,function(a){function b(){j&&clearInterval(j),j=setInterval(h,1e3*i)}function c(b){if(a.has(l,b)){if(l[b].expire_time===!0||l[b].expire_time-1>parseInt(Math.floor(a.now()/1e3)))return!0;e(b)}return!1}function d(c,d,e){!a.isUndefined(e)&&a.isNumber(Number(e))&&a.isFinite(Number(e))||(e=b.CACHE_MEDIUM),l[c]={value:d,live_time:e,expire_time:e===!0?!0:parseInt(Math.floor(a.now()/1e3))+e}}function e(){a.each(a.flatten(arguments),function(a){delete l[a]})}function f(e,f,g){var h=b.CACHE_MEDIUM,i=[];if(a.isUndefined(g)&&(g=!0),c(e)){var j=l[e];if(h=j.live_time,i=j.value,a.isArray(i)||(i=[i]),g)i.push(f);else{var k=a.lastIndexOf(i,f);-1!=k&&i.splice(k,1)}}else{if(!g)return;i.push(f)}return d(e,i,h),l[e].value}function g(b,e,f){return!a.isUndefined(e)&&a.isNumber(Number(e))&&a.isFinite(Number(e))||(e=1),a.isUndefined(f)&&(f=!0),e=f?Math.abs(e):-1*Math.abs(e),c(b)?(l[b].value=Number(l[b].value),a.isNumber(l[b].value)&&a.isFinite(l[b].value)||(l[b].value=0),l[b].value+=e):d(b,e),l[b].value}function h(){var b=[],c=parseInt(Math.floor(a.now()/1e3));a.each(l,function(a,d){a.expire_time!==!0&&a.expire_time<=c&&b.push(d)}),e(b)}var i,j,k,l={};k={CACHE_MIN:10,CACHE_TINY:60,CACHE_SHORT:300,CACHE_MEDIUM:600,CACHE_LONG:3600,CACHE_FOREVER:!0};for(var m in k)k.hasOwnProperty(m)&&Object.defineProperty(b,m,{enumerable:!0,value:k[m]});return i=b.CACHE_MIN,b.prototype.set=function(a,b,c){d(a,b,c)},b.prototype.has=function(a){return c(a)},b.prototype.get=function(b,c){if(a.has(l,b)){if(l[b].expire_time===!0||l[b].expire_time>parseInt(Math.floor(a.now()/1e3)))return l[b].value;delete l[b]}return c},b.prototype.touch=function(b,c){if(this.has(b)){if(l[b].expire_time!==!0){var d=l[b];return a.isNumber(c)&&a.isFinite(c)||(c=d.live_time),d.expire_time=Math.max(d.expire_time,parseInt(Math.floor(a.now()/1e3))+c),d.expire_time}return!0}return!1},b.prototype.list=function(b){var c,d,e=parseInt(Math.floor(a.now()/1e3));return b||a.isUndefined(b)?(c=[],d=function(a){c.push(a)}):(c={},d=function(a,b){c[a]=b}),a.each(l,function(a,b){(a.expire_time===!0||e<a.expire_time)&&d(b,a)}),c},b.prototype.clean=function(){return h()},b.prototype.expire=function(){e(Array.prototype.slice.apply(arguments))},b.prototype.increment=function(b,c){return a.isNumber(c)&&a.isFinite(c)||(c=1),g(b,c,!0)},b.prototype.decrement=function(b,c){return a.isNumber(c)&&a.isFinite(c)||(c=1),g(b,c,!1)},b.prototype.arrayPush=function(a,b){return f(a,b,!0)},b.prototype.arrayWithout=function(a,b){return f(a,b,!1)},new b}),function(a,b){"function"==typeof define&&define.amd?define(["lodash","madnh"],function(c,d){return a.Task=b(c,d)}):a.Task=b(a._,a.M)}(this,function(a,b){function c(b){this.id=a.uniqueId("Task_"),this.name="",this.options={},this.handler=b||null,this._result=null,this._error=null}function d(a,b,c){try{b.bind(a)(c,a.setProcessResult.bind(a),a.setProcessError.bind(a))}catch(d){a.setProcessError(d.message||d.description,d.number||0)}}function e(a,b,c){b.process(c),a._result=b.getResult(),a._error=b.getError()}var f={};return c.prototype.option=function(b,c){var d=this;return a.isObject(b)?a.each(b,function(b,c){a.set(d.options,c,b)}):a.set(this.options,b,c),this},c.prototype.isError=function(){return!a.isNull(this._error)},c.prototype.getError=function(){return this.isError()?a.pick(a.extend({code:0,message:""},a.isObject(this._error)?this._error:{}),"code","message"):null},c.prototype.getResult=function(){return this._result},c.prototype.setProcessResult=function(a){this._result=a,this._error=null},c.prototype.setProcessError=function(a,b){this._result=null,this._error={message:a,code:b||0}},c.prototype.process=function(b){var f=this;return this._result=a.cloneDeep(b),this._error=null,a.isString(this.handler)&&(this.handler=a.castArray(this.handler)),a.isFunction(this.handler)?d(this,this.handler,b):this.handler instanceof c?e(this,this.handler,f._result):a.isArray(this.handler)?a.find(this.handler,function(b){var d;return d=a.isString(b)?c.factory(b):new c(b),e(f,d,f._result),f.isError()}):a.isObject(this.handler)&&a.find(this.handler,function(b,d){var g=c.factory(d);return a.isEmpty(b)||g.options(b),e(f,g,f._result),
f.isError()}),!this.isError()},c.isRegistered=function(a){return f.hasOwnProperty(a)},c.list=function(){return Object.keys(f)},c.register=function(b,d,e){if(a.isObject(b)){if(e=a.isObject(d)?d:{},d=b,!(d instanceof c))throw new Error("Task name is unknown");b=d.name}f[b]={handler:d,options:e||{}}},c.factory=function(b,d){if(c.isRegistered(b)){var e=f[b],g=new c;return g.name=b,g.handler=e.handler,g.options=e.options,a.isObject(d)&&g.option(d),g}throw new Error("Create an unregistered task: "+b)},c.apply=function(b,d){var e={data:a.cloneDeep(b)};return d&&(a.isString(d)&&(d=[d]),a.isArray(d)&&(d=a.zipObject(d,a.fill(new Array(d.length),{}))),a.find(d,function(b,d){var f=c.factory(d,b);return f.process(a.cloneDeep(e.data))?void(e.data=f.getResult()):(delete e.data,e.error=f.getError(),!0)})),e},c});
//# sourceMappingURL=madnh.min.js.map